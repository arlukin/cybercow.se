<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>fareofficelib: Communication Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Communication Class Reference<br>
<small>
[<a class="el" href="group__general.html">General</a>]</small>
</h1><!-- doxytag: class="Communication" -->Sends SMS and Email messages.  
<a href="#_details">More...</a>
<p>

<p>
<a href="classCommunication-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#be6b0d84174364050b009bbc56d93457">Communication</a> (iLock $sendLock_)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructor.  <a href="#be6b0d84174364050b009bbc56d93457"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#bf319fe335258e59fc6ee6ae0c508edb">sendEmail</a> ($from_, $toArr_, $subject_, $text_, $html_=NULL)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send an email.  <a href="#bf319fe335258e59fc6ee6ae0c508edb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#41bd0188ee03588cf8839031fe5d3275">sendSms</a> ($fromEmail_, $fromName_, $toArr_, $message_, $repeatTime_=60)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends an SMS message to a mobile phone.  <a href="#41bd0188ee03588cf8839031fe5d3275"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#11ae766700e4930431d9b5bd3788f976">$_sendLock</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A lock object that will handle how often an SMS can be sent.  <a href="#11ae766700e4930431d9b5bd3788f976"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Sends SMS and Email messages. 
<p>
This class uses Rmail written by Richard Heyes at www.phpguru.org. The documentation can be found here. <a href="http://www.phpguru.org/downloads/Rmail/Rmail%20for%20PHP/docs.html">http://www.phpguru.org/downloads/Rmail/Rmail%20for%20PHP/docs.html</a><p>
An installation of the Rmail package are included in fareofficelib, to minimize any hazzle getting fareofficelib up and working. But the copyright for Rmail is still owned by Richard Heyes.<p>
Example: <code> $sendLock = new <a class="el" href="classFileLock.html" title="Include files.">FileLock</a>('/tmp/locks/'); $communication = new <a class="el" href="classCommunication.html" title="Sends SMS and Email messages.">Communication</a>($sendLock); $communication-&gt;sendSms('monitor.fareoffice.com', '0731234567', 'Hello world); </code><p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Daniel Lindh &lt;<a href="mailto:daniel@fareoffice.com">daniel@fareoffice.com</a>&gt; </dd></dl>

<p>Definition at line <a class="el" href="Communication_8class_8php-source.html#l00024">24</a> of file <a class="el" href="Communication_8class_8php-source.html">Communication.class.php</a>.</p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="be6b0d84174364050b009bbc56d93457"></a><!-- doxytag: member="Communication::Communication" ref="be6b0d84174364050b009bbc56d93457" args="(iLock $sendLock_)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Communication::Communication           </td>
          <td>(</td>
          <td class="paramtype">iLock $&nbsp;</td>
          <td class="paramname"> <em>sendLock_</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Constructor. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$sendLock_</em>&nbsp;</td><td>- iLock - A lock object that will handle how often an SMS can be sent. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="Communication_8class_8php-source.html#l00032">32</a> of file <a class="el" href="Communication_8class_8php-source.html">Communication.class.php</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00033"></a>00033   {
<a name="l00034"></a>00034     $this-&gt;_sendLock = $sendLock_;
<a name="l00035"></a>00035   }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="bf319fe335258e59fc6ee6ae0c508edb"></a><!-- doxytag: member="Communication::sendEmail" ref="bf319fe335258e59fc6ee6ae0c508edb" args="($from_, $toArr_, $subject_, $text_, $html_=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Communication::sendEmail           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>from_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>toArr_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>subject_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>text_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>html_</em> = <code>NULL</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send an email. 
<p>
Supports both plain text and html messages.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$from_</em>&nbsp;</td><td>- string - The from email address. Ie. info(at)example.com</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$toArr_</em>&nbsp;</td><td>- array - The to email addresses, can be many. $toArr_[] = 'daniel(at)example.com'; $toArr_[] = 'support(at)example.com';</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$subject_</em>&nbsp;</td><td>- string - The email subject.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$text_</em>&nbsp;</td><td>- string - The text part of the email.</td></tr>
  </table>
</dl>
An email can have both a text and an html part, the html part will be read if the email client supports html, or else the text part will be used.<p>
This argument and/or $html needs to be used, if this argument is empty the $html_ will be used for the text part of the message but with striped html tags.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$html_</em>&nbsp;</td><td>- string - The HTML part of the email.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>- string - errorMessage If sendEmail fails, an error message will be returned. If sendEmail succededs, false will be returned. </dd></dl>

<p>Definition at line <a class="el" href="Communication_8class_8php-source.html#l00072">72</a> of file <a class="el" href="Communication_8class_8php-source.html">Communication.class.php</a>.</p>

<p>Referenced by <a class="el" href="Communication_8class_8php-source.html#l00149">sendSms()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00073"></a>00073   {
<a name="l00074"></a>00074     <span class="keywordflow">if</span> (!empty($from_) &amp;&amp; !empty($toArr_) &amp;&amp; !empty($subject_) &amp;&amp; (!empty($text_) || !empty($html_)))
<a name="l00075"></a>00075     {
<a name="l00076"></a>00076       $mail = <span class="keyword">new</span> Rmail();
<a name="l00077"></a>00077 
<a name="l00078"></a>00078       <span class="keywordflow">if</span> (!empty($html_))
<a name="l00079"></a>00079       {
<a name="l00080"></a>00080         <span class="keywordflow">if</span> (empty($text_))
<a name="l00081"></a>00081         {
<a name="l00082"></a>00082           $text_ = strip_tags($html_);
<a name="l00083"></a>00083         }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         $mail-&gt;setHTML($html_, $text_);
<a name="l00086"></a>00086       }
<a name="l00087"></a>00087       <span class="keywordflow">else</span>
<a name="l00088"></a>00088       {
<a name="l00089"></a>00089         $mail-&gt;setText($text_);
<a name="l00090"></a>00090       }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092       $mail-&gt;setReturnPath($from_);
<a name="l00093"></a>00093       $mail-&gt;setFrom($from_);
<a name="l00094"></a>00094       $mail-&gt;setSubject($subject_);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096       <span class="keywordflow">if</span> (!is_array($toArr_))
<a name="l00097"></a>00097       {
<a name="l00098"></a>00098         $toArr_ = array($toArr_);
<a name="l00099"></a>00099       }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101       $mailResult = $mail-&gt;send($toArr_);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103       <span class="keywordflow">if</span> (!$mailResult)
<a name="l00104"></a>00104       {
<a name="l00105"></a>00105         <span class="keywordflow">return</span> <span class="stringliteral">'Failed to send mail'</span>;
<a name="l00106"></a>00106       }
<a name="l00107"></a>00107       <span class="keywordflow">else</span>
<a name="l00108"></a>00108       {
<a name="l00109"></a>00109         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00110"></a>00110       }
<a name="l00111"></a>00111     }
<a name="l00112"></a>00112     <span class="keywordflow">else</span>
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114       <span class="keywordflow">return</span> <span class="stringliteral">'Failed to send mail, one or more parameters wasn\'t entered.'</span>;
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116   }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="41bd0188ee03588cf8839031fe5d3275"></a><!-- doxytag: member="Communication::sendSms" ref="41bd0188ee03588cf8839031fe5d3275" args="($fromEmail_, $fromName_, $toArr_, $message_, $repeatTime_=60)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Communication::sendSms           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>fromEmail_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>fromName_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>toArr_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>message_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>repeatTime_</em> = <code>60</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sends an SMS message to a mobile phone. 
<p>
The function uses the (at)esms.nu service.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$fromEmail_</em>&nbsp;</td><td>- string - esms requires all sms-emails to be sent from a registered email-address. Ie. sms(at)example.com</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$fromName_</em>&nbsp;</td><td>- string - The from name that will be displayed in the SMS Ie. Daniel 0731234567</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$toArr_</em>&nbsp;</td><td>- string - A list of cell phone numbers that will recieve the message. Ie. 0731234567</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$message_</em>&nbsp;</td><td>- string - The text that will be sent on the sms. The message will be truncated to 160 chars.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$repeatTime_</em>&nbsp;</td><td>- integer The number of seconds to wait until next sms can be sent. To prevent sms flooding.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>$errorMessage - string - If sendEmail fails, an error message will be returned. If sendEmail succededs, false will be returned. </dd></dl>

<p>Definition at line <a class="el" href="Communication_8class_8php-source.html#l00149">149</a> of file <a class="el" href="Communication_8class_8php-source.html">Communication.class.php</a>.</p>

<p>References <a class="el" href="Communication_8class_8php-source.html#l00072">sendEmail()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00150"></a>00150   {
<a name="l00151"></a>00151     <span class="keywordflow">if</span> (!empty($message_))
<a name="l00152"></a>00152     {
<a name="l00153"></a>00153       $message_ = substr($message_, 0, 160);
<a name="l00154"></a>00154       <span class="keywordflow">if</span> (!empty($this-&gt;_sendLock) || $this-&gt;_sendLock-&gt;isLockExpired(<span class="stringliteral">'SMS'</span>, $repeatTime_, <span class="keyword">false</span>))
<a name="l00155"></a>00155       {
<a name="l00156"></a>00156         $cellPhoneArr = array();
<a name="l00157"></a>00157         <span class="keywordflow">if</span> (!is_array($toArr_))
<a name="l00158"></a>00158         {
<a name="l00159"></a>00159           $toArr_ = array($toArr_);
<a name="l00160"></a>00160         }
<a name="l00161"></a>00161         <span class="keywordflow">foreach</span> ($toArr_ as $cellPhone)
<a name="l00162"></a>00162         {
<a name="l00163"></a>00163           $cellPhoneArr[] = $cellPhone . <span class="stringliteral">'@esms.nu'</span>;
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCommunication.html#bf319fe335258e59fc6ee6ae0c508edb" title="Send an email.">sendEmail</a>($fromEmail_, $cellPhoneArr, $fromName_, $message_);
<a name="l00166"></a>00166       }
<a name="l00167"></a>00167       <span class="keywordflow">else</span>
<a name="l00168"></a>00168       {
<a name="l00169"></a>00169         <span class="keywordflow">return</span> <span class="stringliteral">'Failed to send sms, to many at to short time.'</span>;
<a name="l00170"></a>00170       }
<a name="l00171"></a>00171     }
<a name="l00172"></a>00172   }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="11ae766700e4930431d9b5bd3788f976"></a><!-- doxytag: member="Communication::$_sendLock" ref="11ae766700e4930431d9b5bd3788f976" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Communication::$_sendLock<code> [private]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
A lock object that will handle how often an SMS can be sent. 
<p>
$_sendLock - <a class="el" href="interfaceILock.html" title="Declare the interface &#39;iLock&#39;.">ILock</a> - 
<p>Definition at line <a class="el" href="Communication_8class_8php-source.html#l00180">180</a> of file <a class="el" href="Communication_8class_8php-source.html">Communication.class.php</a>.</p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following file:<ul>
<li>Static/PhpInclude/FareOfficeLib/General/<a class="el" href="Communication_8class_8php-source.html">Communication.class.php</a></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed May 6 23:28:24 2009 for fareofficelib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
