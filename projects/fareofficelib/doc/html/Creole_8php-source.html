<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>fareofficelib: Static/PhpInclude/FareOfficeLib/3dPart/creole/Creole.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>Static/PhpInclude/FareOfficeLib/3dPart/creole/Creole.php</h1><a href="Creole_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> *  $Id: Creole.php,v 1.14 2006/01/17 20:06:31 hlellelid Exp $</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00006"></a>00006 <span class="comment"> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00007"></a>00007 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00008"></a>00008 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00009"></a>00009 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00010"></a>00010 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00011"></a>00011 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00012"></a>00012 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00013"></a>00013 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00014"></a>00014 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00015"></a>00015 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * This software consists of voluntary contributions made by many individuals</span>
<a name="l00018"></a>00018 <span class="comment"> * and is licensed under the LGPL. For more information please see</span>
<a name="l00019"></a>00019 <span class="comment"> * &lt;http://creole.phpdb.org&gt;.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 include_once <span class="stringliteral">'creole/SQLException.php'</span>;
<a name="l00023"></a>00023 include_once <span class="stringliteral">'creole/Connection.php'</span>;
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">// static:</span>
<a name="l00026"></a>00026 <span class="comment">// track errors is used by drivers to get better error messages</span>
<a name="l00027"></a>00027 <span class="comment">// make sure it's set.</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 @ini_set(<span class="stringliteral">'track_errors'</span>, <span class="keyword">true</span>);
<a name="l00030"></a>00030 
<a name="l00046"></a><a class="code" href="classCreole.html">00046</a> <span class="keyword">class </span><a class="code" href="classCreole.html">Creole</a> {
<a name="l00047"></a>00047 
<a name="l00051"></a><a class="code" href="classCreole.html#6a259fc2d3a707573374044e3dda3920">00051</a>     <span class="keyword">const</span> <a class="code" href="classCreole.html#6a259fc2d3a707573374044e3dda3920" title="Constant that indicates a connection object should be used.">PERSISTENT</a> = 1;
<a name="l00052"></a>00052 
<a name="l00058"></a><a class="code" href="classCreole.html#d15960a1cded9cc9857431f2eb87762a">00058</a>     <span class="keyword">const</span> <a class="code" href="classCreole.html#d15960a1cded9cc9857431f2eb87762a" title="Flag to pass to the connection to indicate that no case conversions should be performed...">NO_ASSOC_LOWER</a> = 16;
<a name="l00059"></a>00059 
<a name="l00064"></a><a class="code" href="classCreole.html#95b169afed923c896ecbb410a7dbddc8">00064</a>   <span class="keyword">const</span> <a class="code" href="classCreole.html#95b169afed923c896ecbb410a7dbddc8" title="Flag to pass to the connection to indicate that a to-lower case conversion should...">COMPAT_ASSOC_LOWER</a> = 32;
<a name="l00065"></a>00065 
<a name="l00070"></a><a class="code" href="classCreole.html#7d1a63ca60e38202053e859bde9e5cff">00070</a>   <span class="keyword">const</span> <a class="code" href="classCreole.html#7d1a63ca60e38202053e859bde9e5cff" title="Flag to pass to the connection to indicate that an rtrim() should be performed on...">COMPAT_RTRIM_STRING</a> = 64;
<a name="l00071"></a>00071 
<a name="l00075"></a><a class="code" href="classCreole.html#9c2a9d141b160ec7a293aa15beff1519">00075</a>   <span class="keyword">const</span> <a class="code" href="classCreole.html#9c2a9d141b160ec7a293aa15beff1519" title="Flag to indicate that all compatibility flags should be set.">COMPAT_ALL</a> = 96;
<a name="l00076"></a>00076 
<a name="l00083"></a><a class="code" href="classCreole.html#10cbc76caac9af0826856e7cf9c6ba84">00083</a>     <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="classCreole.html#10cbc76caac9af0826856e7cf9c6ba84">$driverMap</a> = array(  <span class="stringliteral">'mysql'</span> =&gt; <span class="stringliteral">'creole.drivers.mysql.MySQLConnection'</span>,
<a name="l00084"></a>00084                                         <span class="stringliteral">'mysqli'</span> =&gt; <span class="stringliteral">'creole.drivers.mysqli.MySQLiConnection'</span>,
<a name="l00085"></a>00085                                         <span class="stringliteral">'pgsql'</span> =&gt; <span class="stringliteral">'creole.drivers.pgsql.PgSQLConnection'</span>,
<a name="l00086"></a>00086                                         <span class="stringliteral">'sqlite'</span> =&gt; <span class="stringliteral">'creole.drivers.sqlite.SQLiteConnection'</span>,
<a name="l00087"></a>00087                                         <span class="stringliteral">'oracle'</span> =&gt; <span class="stringliteral">'creole.drivers.oracle.OCI8Connection'</span>,
<a name="l00088"></a>00088                                         <span class="stringliteral">'mssql'</span> =&gt; <span class="stringliteral">'creole.drivers.mssql.MSSQLConnection'</span>,
<a name="l00089"></a>00089                                         <span class="stringliteral">'odbc'</span> =&gt; <span class="stringliteral">'creole.drivers.odbc.ODBCConnection'</span>
<a name="l00090"></a>00090                                        );
<a name="l00091"></a>00091 
<a name="l00097"></a><a class="code" href="classCreole.html#82d564bbe0887218bd4de1e9a80c5700">00097</a>     <span class="keyword">private</span> <span class="keyword">static</span> <a class="code" href="classCreole.html#82d564bbe0887218bd4de1e9a80c5700">$connectionMap</a> = array();
<a name="l00098"></a>00098 
<a name="l00126"></a><a class="code" href="classCreole.html#ac2610fd8190659b7ed8d4fcabd88d6b">00126</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCreole.html#ac2610fd8190659b7ed8d4fcabd88d6b" title="Register your own RDBMS driver class.">registerDriver</a>($phptype, $dotpath)
<a name="l00127"></a>00127     {
<a name="l00128"></a>00128         self::$driverMap[$phptype] = $dotpath;
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130 
<a name="l00137"></a><a class="code" href="classCreole.html#cb7e4e4270a5b20afb3fcdca2893624e">00137</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCreole.html#cb7e4e4270a5b20afb3fcdca2893624e" title="Removes the driver for a PHP type.">deregisterDriver</a>($phptype)
<a name="l00138"></a>00138     {
<a name="l00139"></a>00139         unset(self::$driverMap[$phptype]);
<a name="l00140"></a>00140     }
<a name="l00141"></a>00141 
<a name="l00148"></a><a class="code" href="classCreole.html#7f39665cbd43fffabe379a0cb57da01d">00148</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCreole.html#7f39665cbd43fffabe379a0cb57da01d" title="Returns the class path to the driver registered for specified type.">getDriver</a>($phptype)
<a name="l00149"></a>00149     {
<a name="l00150"></a>00150         <span class="keywordflow">if</span> (isset(self::$driverMap[$phptype])) {
<a name="l00151"></a>00151             <span class="keywordflow">return</span> self::$driverMap[$phptype];
<a name="l00152"></a>00152         } <span class="keywordflow">else</span> {
<a name="l00153"></a>00153             <span class="keywordflow">return</span> null;
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155     }
<a name="l00156"></a>00156 
<a name="l00171"></a><a class="code" href="classCreole.html#cd4b42e71543e0532d911c43fe51f1b0">00171</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCreole.html#cd4b42e71543e0532d911c43fe51f1b0" title="Create a new DB connection object and connect to the specified database.">getConnection</a>($dsn, $flags = 0)
<a name="l00172"></a>00172     {
<a name="l00173"></a>00173         <span class="keywordflow">if</span> (is_array($dsn)) {
<a name="l00174"></a>00174             $dsninfo = $dsn;
<a name="l00175"></a>00175         } <span class="keywordflow">else</span> {
<a name="l00176"></a>00176             $dsninfo = <a class="code" href="classCreole.html#bf01176bee0c3c3f41b4f20001ad9c4b">self::parseDSN</a>($dsn);
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="comment">// gather any flags from the DSN</span>
<a name="l00180"></a>00180     <span class="keywordflow">if</span> ( isset ( $dsninfo[<span class="stringliteral">'persistent'</span>] ) &amp;&amp; ! empty ( $dsninfo[<span class="stringliteral">'persistent'</span>] ) )
<a name="l00181"></a>00181       $flags |= <a class="code" href="classCreole.html#6a259fc2d3a707573374044e3dda3920" title="Constant that indicates a connection object should be used.">Creole::PERSISTENT</a>;
<a name="l00182"></a>00182     <span class="keywordflow">if</span> ( isset ( $dsninfo[<span class="stringliteral">'compat_assoc_lower'</span>] ) &amp;&amp; ! empty ( $dsninfo[<span class="stringliteral">'compat_assoc_lower'</span>] ) )
<a name="l00183"></a>00183       $flags |= <a class="code" href="classCreole.html#95b169afed923c896ecbb410a7dbddc8" title="Flag to pass to the connection to indicate that a to-lower case conversion should...">Creole::COMPAT_ASSOC_LOWER</a>;
<a name="l00184"></a>00184     <span class="keywordflow">if</span> ( isset ( $dsninfo[<span class="stringliteral">'compat_rtrim_string'</span>] ) &amp;&amp; ! empty ( $dsninfo[<span class="stringliteral">'compat_rtrim_string'</span>] ) )
<a name="l00185"></a>00185       $flags |= <a class="code" href="classCreole.html#7d1a63ca60e38202053e859bde9e5cff" title="Flag to pass to the connection to indicate that an rtrim() should be performed on...">Creole::COMPAT_RTRIM_STRING</a>;
<a name="l00186"></a>00186     <span class="keywordflow">if</span> ( isset ( $dsninfo[<span class="stringliteral">'compat_all'</span>] ) &amp;&amp; ! empty ( $dsninfo[<span class="stringliteral">'compat_all'</span>] ) )
<a name="l00187"></a>00187       $flags |= <a class="code" href="classCreole.html#9c2a9d141b160ec7a293aa15beff1519" title="Flag to indicate that all compatibility flags should be set.">Creole::COMPAT_ALL</a>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="keywordflow">if</span> ($flags &amp; <a class="code" href="classCreole.html#d15960a1cded9cc9857431f2eb87762a" title="Flag to pass to the connection to indicate that no case conversions should be performed...">Creole::NO_ASSOC_LOWER</a>) {
<a name="l00190"></a>00190       trigger_error(<span class="stringliteral">"The Creole::NO_ASSOC_LOWER flag has been deprecated, and is now the default behavior. Use Creole::COMPAT_ASSOC_LOWER to lowercase resulset keys."</span>, E_USER_WARNING);
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193         <span class="comment">// sort $dsninfo by keys so the serialized result is always the same</span>
<a name="l00194"></a>00194         <span class="comment">// for identical connection parameters, no matter what their order is</span>
<a name="l00195"></a>00195         ksort($dsninfo);
<a name="l00196"></a>00196         $connectionMapKey = crc32(serialize($dsninfo + array(<span class="stringliteral">'compat_flags'</span> =&gt; ($flags &amp; <a class="code" href="classCreole.html#9c2a9d141b160ec7a293aa15beff1519" title="Flag to indicate that all compatibility flags should be set.">Creole::COMPAT_ALL</a>))));
<a name="l00197"></a>00197 
<a name="l00198"></a>00198         <span class="comment">// see if we already have a connection with these parameters cached</span>
<a name="l00199"></a>00199         <span class="keywordflow">if</span>(isset(self::$connectionMap[$connectionMapKey]))
<a name="l00200"></a>00200         {
<a name="l00201"></a>00201             <span class="comment">// persistent connections will be used if a non-persistent one was requested and is available</span>
<a name="l00202"></a>00202             <span class="comment">// but a persistent connection will be created if a non-persistent one is present</span>
<a name="l00203"></a>00203 
<a name="l00204"></a>00204       <span class="comment">// TODO: impliment auto close of non persistent and replacing the</span>
<a name="l00205"></a>00205       <span class="comment">// non persistent with the persistent object so as we dont have</span>
<a name="l00206"></a>00206       <span class="comment">// both links open for no reason</span>
<a name="l00207"></a>00207 
<a name="l00208"></a>00208             <span class="keywordflow">if</span>( isset(self::$connectionMap[$connectionMapKey][1]) ) { <span class="comment">// is persistent</span>
<a name="l00209"></a>00209                 <span class="comment">// a persistent connection with these parameters is already there,</span>
<a name="l00210"></a>00210                 <span class="comment">// so we return it, no matter what was specified as persistent flag</span>
<a name="l00211"></a>00211                 $con = self::$connectionMap[$connectionMapKey][1];
<a name="l00212"></a>00212             } <span class="keywordflow">else</span> {
<a name="l00213"></a>00213                 <span class="comment">// we don't have a persistent connection, and since the persistent</span>
<a name="l00214"></a>00214                 <span class="comment">// flag wasn't set either, we just return the non-persistent connection</span>
<a name="l00215"></a>00215                 $con = self::$connectionMap[$connectionMapKey][0];
<a name="l00216"></a>00216             }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218             <span class="comment">// if we're here, a non-persistent connection was already there, but</span>
<a name="l00219"></a>00219             <span class="comment">// the user wants a persistent one, so it will be created</span>
<a name="l00220"></a>00220 
<a name="l00221"></a>00221             <span class="keywordflow">if</span> ($con-&gt;isConnected())
<a name="l00222"></a>00222                 <span class="keywordflow">return</span> $con;
<a name="l00223"></a>00223         }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         <span class="comment">// support "catchall" drivers which will themselves handle the details of connecting</span>
<a name="l00226"></a>00226         <span class="comment">// using the proper RDBMS driver.</span>
<a name="l00227"></a>00227         <span class="keywordflow">if</span> (isset(self::$driverMap[<span class="charliteral">'*'</span>])) {
<a name="l00228"></a>00228             $type = <span class="charliteral">'*'</span>;
<a name="l00229"></a>00229         } <span class="keywordflow">else</span> {
<a name="l00230"></a>00230             $type = $dsninfo[<span class="stringliteral">'phptype'</span>];
<a name="l00231"></a>00231             <span class="keywordflow">if</span> (!isset(self::$driverMap[$type])) {
<a name="l00232"></a>00232                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classSQLException.html">SQLException</a>(<span class="stringliteral">"No driver has been registered to handle connection type: $type"</span>);
<a name="l00233"></a>00233             }
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         <span class="comment">// may need to make this more complex if we add support</span>
<a name="l00237"></a>00237         <span class="comment">// for 'dbsyntax'</span>
<a name="l00238"></a>00238         $clazz = <a class="code" href="classCreole.html#979d945c2e974918a918d8de2babe0f1" title="Include once a file specified in DOT notation.">self::import</a>(self::$driverMap[$type]);
<a name="l00239"></a>00239         $obj = <span class="keyword">new</span> $clazz();
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <span class="keywordflow">if</span> (!($obj instanceof <a class="code" href="interfaceConnection.html">Connection</a>)) {
<a name="l00242"></a>00242             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classSQLException.html">SQLException</a>(<span class="stringliteral">"Class does not implement creole.Connection interface: $clazz"</span>);
<a name="l00243"></a>00243         }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         <span class="keywordflow">try</span> {
<a name="l00246"></a>00246             $obj-&gt;connect($dsninfo, $flags);
<a name="l00247"></a>00247         } <span class="keywordflow">catch</span>(<a class="code" href="classSQLException.html">SQLException</a> $sqle) {
<a name="l00248"></a>00248             $sqle-&gt;<a class="code" href="classSQLException.html#391e38e6a724912984d6ea738367d63a" title="Sets additional user / debug information for this error.">setUserInfo</a>($dsninfo);
<a name="l00249"></a>00249             <span class="keywordflow">throw</span> $sqle;
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251     $persistent = ($flags &amp; <a class="code" href="classCreole.html#6a259fc2d3a707573374044e3dda3920" title="Constant that indicates a connection object should be used.">Creole::PERSISTENT</a>) === <a class="code" href="classCreole.html#6a259fc2d3a707573374044e3dda3920" title="Constant that indicates a connection object should be used.">Creole::PERSISTENT</a>;
<a name="l00252"></a>00252         <span class="keywordflow">return</span> self::$connectionMap[$connectionMapKey][(int)$persistent] = $obj;
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 
<a name="l00286"></a><a class="code" href="classCreole.html#bf01176bee0c3c3f41b4f20001ad9c4b">00286</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCreole.html#bf01176bee0c3c3f41b4f20001ad9c4b">parseDSN</a>($dsn)
<a name="l00287"></a>00287     {
<a name="l00288"></a>00288         <span class="keywordflow">if</span> (is_array($dsn)) {
<a name="l00289"></a>00289             <span class="keywordflow">return</span> $dsn;
<a name="l00290"></a>00290         }
<a name="l00291"></a>00291 
<a name="l00292"></a>00292         $parsed = array(
<a name="l00293"></a>00293             <span class="stringliteral">'phptype'</span>  =&gt; null,
<a name="l00294"></a>00294             <span class="stringliteral">'username'</span> =&gt; null,
<a name="l00295"></a>00295             <span class="stringliteral">'password'</span> =&gt; null,
<a name="l00296"></a>00296             <span class="stringliteral">'protocol'</span> =&gt; null,
<a name="l00297"></a>00297             <span class="stringliteral">'hostspec'</span> =&gt; null,
<a name="l00298"></a>00298             <span class="stringliteral">'port'</span>     =&gt; null,
<a name="l00299"></a>00299             <span class="stringliteral">'socket'</span>   =&gt; null,
<a name="l00300"></a>00300             <span class="stringliteral">'database'</span> =&gt; null
<a name="l00301"></a>00301         );
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     $preg_query = <span class="stringliteral">"!^(([a-z0-9]+)(\(([^()]+)\))?)(://((((([^@/:]+)(:([^@/]+))?)@)?((([a-z]+)\((([^?():]+)(:([^()?]+))?)\))|((([^/?:]+)(:([^/?]+))?))))/?)?([^?]+)?(\?(.+))?)?$!i"</span>;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     $info = array();
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="keywordflow">if</span> (preg_match($preg_query,$dsn,$info)) { <span class="comment">// only if it is matching</span>
<a name="l00308"></a>00308 
<a name="l00309"></a>00309       $parsed[<span class="stringliteral">'phptype'</span>] = @$info[2]; <span class="comment">// Group 2 should always exist.</span>
<a name="l00310"></a>00310 
<a name="l00311"></a>00311       <span class="comment">// Don't know what to do with Group 4: phptype(xx) should =&gt; check first if available</span>
<a name="l00312"></a>00312 
<a name="l00313"></a>00313       <span class="keywordflow">if</span> (isset($info[5])) { <span class="comment">// There is more than just the phptype</span>
<a name="l00314"></a>00314 
<a name="l00315"></a>00315         <span class="keywordflow">if</span> (strlen($info[10]) &gt; 0) { <span class="comment">// There is a username specified</span>
<a name="l00316"></a>00316           $parsed[<span class="stringliteral">'username'</span>] = @$info[10];
<a name="l00317"></a>00317         }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319         <span class="keywordflow">if</span> (strlen($info[12]) &gt; 0) { <span class="comment">// There is a password specified</span>
<a name="l00320"></a>00320           $parsed[<span class="stringliteral">'password'</span>] = @$info[12];
<a name="l00321"></a>00321         }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323         <span class="keywordflow">if</span> (strlen($info[15]) &gt; 0) { <span class="comment">// There is a protocol specified: protocol(hostspec)</span>
<a name="l00324"></a>00324           $parsed[<span class="stringliteral">'protocol'</span>] = @$info[15];
<a name="l00325"></a>00325 
<a name="l00326"></a>00326           <span class="keywordflow">if</span> ($parsed[<span class="stringliteral">"protocol"</span>] === <span class="stringliteral">"unix"</span>) {
<a name="l00327"></a>00327             $parsed[<span class="stringliteral">'socket'</span>] = @$info[16];
<a name="l00328"></a>00328           } <span class="keywordflow">else</span> {
<a name="l00329"></a>00329             $parsed[<span class="stringliteral">"hostspec"</span>] = @$info[17];
<a name="l00330"></a>00330             <span class="keywordflow">if</span> (strlen($info[19]) &gt; 0) {
<a name="l00331"></a>00331               $parsed[<span class="stringliteral">"port"</span>] = @$info[19];
<a name="l00332"></a>00332             }
<a name="l00333"></a>00333           }
<a name="l00334"></a>00334         } elseif (strlen($info[20]) &gt; 0) {
<a name="l00335"></a>00335           $parsed[<span class="stringliteral">"hostspec"</span>] = @$info[22];
<a name="l00336"></a>00336 
<a name="l00337"></a>00337           <span class="keywordflow">if</span> ((isset($info[24]) &amp;&amp; (strlen($info[24]) &gt; 0))) { <span class="comment">// There is a port set (not always available)</span>
<a name="l00338"></a>00338             $parsed[<span class="stringliteral">"port"</span>] = @$info[24];
<a name="l00339"></a>00339           }
<a name="l00340"></a>00340         }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342         <span class="keywordflow">if</span> ((isset($info[25])) &amp;&amp; (strlen($info[25]) &gt; 0)) { <span class="comment">// There is a database</span>
<a name="l00343"></a>00343           $parsed[<span class="stringliteral">"database"</span>] = @$info[25];
<a name="l00344"></a>00344         }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346         <span class="keywordflow">if</span> ((isset($info[27])) &amp;&amp; (strlen($info[27]) &gt;0)) { <span class="comment">// There is a query</span>
<a name="l00347"></a>00347           $opts = explode(<span class="charliteral">'&amp;'</span>, $info[27]);
<a name="l00348"></a>00348           <span class="keywordflow">foreach</span> ($opts as $opt) {
<a name="l00349"></a>00349             list($key, $value) = explode(<span class="charliteral">'='</span>, $opt);
<a name="l00350"></a>00350             <span class="keywordflow">if</span> (!isset($parsed[$key])) { <span class="comment">// don't allow params overwrite</span>
<a name="l00351"></a>00351               $parsed[$key] = urldecode($value);
<a name="l00352"></a>00352             }
<a name="l00353"></a>00353           }
<a name="l00354"></a>00354         }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356       }
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359         <span class="keywordflow">return</span> $parsed;
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361 
<a name="l00371"></a><a class="code" href="classCreole.html#979d945c2e974918a918d8de2babe0f1">00371</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <span class="keyword">import</span>($class) {
<a name="l00372"></a>00372         <span class="keywordflow">if</span> (!class_exists($class, <span class="keyword">false</span>)) {
<a name="l00373"></a>00373             $path = strtr($class, <span class="charliteral">'.'</span>, DIRECTORY_SEPARATOR) . <span class="stringliteral">'.php'</span>;
<a name="l00374"></a>00374             $ret = include_once($path);
<a name="l00375"></a>00375             <span class="keywordflow">if</span> ($ret === <span class="keyword">false</span>) {
<a name="l00376"></a>00376                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classSQLException.html">SQLException</a>(<span class="stringliteral">"Unable to load driver class: "</span> . $class);
<a name="l00377"></a>00377             }
<a name="l00378"></a>00378             <span class="comment">// get just classname ('path.to.ClassName' -&gt; 'ClassName')</span>
<a name="l00379"></a>00379             $pos = strrpos($class, <span class="charliteral">'.'</span>);
<a name="l00380"></a>00380             <span class="keywordflow">if</span> ($pos !== <span class="keyword">false</span>) {
<a name="l00381"></a>00381                 $class = substr($class, $pos + 1);
<a name="l00382"></a>00382             }
<a name="l00383"></a>00383             <span class="keywordflow">if</span> (!class_exists($class)) {
<a name="l00384"></a>00384                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classSQLException.html">SQLException</a>(<span class="stringliteral">"Unable to find loaded class: $class (Hint: make sure classname matches filename)"</span>);
<a name="l00385"></a>00385             }
<a name="l00386"></a>00386         }
<a name="l00387"></a>00387         <span class="keywordflow">return</span> $class;
<a name="l00388"></a>00388     }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed May 6 23:10:49 2009 for fareofficelib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
