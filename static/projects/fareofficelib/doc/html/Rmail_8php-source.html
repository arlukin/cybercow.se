<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>fareofficelib: Static/PhpInclude/FareOfficeLib/3dPart/Rmail/Rmail.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>Static/PhpInclude/FareOfficeLib/3dPart/Rmail/Rmail.php</h1><a href="Rmail_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00015"></a>00015 require_once(dirname(__FILE__) . <span class="stringliteral">'/mimePart.php'</span>);
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="classRmail.html">00017</a> <span class="keyword">class </span><a class="code" href="classRmail.html" title="o------------------------------------------------------------------------------o...">Rmail</a>
<a name="l00018"></a>00018 {
<a name="l00023"></a><a class="code" href="classRmail.html#12a455cf50018a43f2668f91bf62b727">00023</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#12a455cf50018a43f2668f91bf62b727">$html</a>;
<a name="l00024"></a>00024 
<a name="l00029"></a><a class="code" href="classRmail.html#a808be34d284f78a5bcfefc833a68da0">00029</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#a808be34d284f78a5bcfefc833a68da0" title="The text part of the message(only used in TEXT only messages) string.">$text</a>;
<a name="l00030"></a>00030 
<a name="l00035"></a><a class="code" href="classRmail.html#872ba801333240c5e3243ad00d48110a">00035</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#872ba801333240c5e3243ad00d48110a" title="The main body of the message after building string.">$output</a>;
<a name="l00036"></a>00036 
<a name="l00041"></a><a class="code" href="classRmail.html#9050252f46197523a890385326341696">00041</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a>;
<a name="l00042"></a>00042 
<a name="l00047"></a><a class="code" href="classRmail.html#416a59fa6150826f6e9e1f29abb764a1">00047</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#416a59fa6150826f6e9e1f29abb764a1" title="An array of recognised image types for the findHtmlImages() method array.">$image_types</a>;
<a name="l00048"></a>00048 
<a name="l00053"></a><a class="code" href="classRmail.html#0ba5640708222d4131ca517da49afce6">00053</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#0ba5640708222d4131ca517da49afce6" title="Parameters that affect the build process array.">$build_params</a>;
<a name="l00054"></a>00054 
<a name="l00059"></a><a class="code" href="classRmail.html#2765b590dba786bb1b621d0a3142b8ab">00059</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#2765b590dba786bb1b621d0a3142b8ab" title="Array of attachments array.">$attachments</a>;
<a name="l00060"></a>00060 
<a name="l00065"></a><a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb">00065</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>;
<a name="l00066"></a>00066     
<a name="l00072"></a><a class="code" href="classRmail.html#276d1322b32d90380a5df460ea44212a">00072</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#276d1322b32d90380a5df460ea44212a" title="The return path address.">$return_path</a>;
<a name="l00073"></a>00073     
<a name="l00078"></a><a class="code" href="classRmail.html#34fc1694f28717b381f6386c07031c82">00078</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#34fc1694f28717b381f6386c07031c82" title="Array of information needed for smtp sending array.">$smtp_params</a>;
<a name="l00079"></a>00079 
<a name="l00084"></a><a class="code" href="classRmail.html#945a143220d1df93ccd94221359a4741">00084</a>     <span class="keyword">private</span> <a class="code" href="classRmail.html#945a143220d1df93ccd94221359a4741" title="Sendmail path.">$sendmail_path</a>;
<a name="l00085"></a>00085 
<a name="l00089"></a><a class="code" href="classRmail.html#33ec62a92dfb187f33b9c66ee90a1df6">00089</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#33ec62a92dfb187f33b9c66ee90a1df6" title="Constructor function.">__construct</a>()
<a name="l00090"></a>00090     {
<a name="l00094"></a>00094         $this-&gt;attachments   = array();
<a name="l00095"></a>00095         $this-&gt;html_images   = array();
<a name="l00096"></a>00096         $this-&gt;headers       = array();
<a name="l00097"></a>00097         $this-&gt;text          = <span class="stringliteral">''</span>;
<a name="l00098"></a>00098         $this-&gt;sendmail_path = <span class="stringliteral">'/usr/lib/sendmail -ti'</span>;
<a name="l00099"></a>00099 
<a name="l00105"></a>00105         $this-&gt;image_types = array(<span class="stringliteral">'gif'</span>  =&gt; <span class="stringliteral">'image/gif'</span>,
<a name="l00106"></a>00106                                    <span class="stringliteral">'jpg'</span>  =&gt; <span class="stringliteral">'image/jpeg'</span>,
<a name="l00107"></a>00107                                    <span class="stringliteral">'jpeg'</span> =&gt; <span class="stringliteral">'image/jpeg'</span>,
<a name="l00108"></a>00108                                    <span class="stringliteral">'jpe'</span>  =&gt; <span class="stringliteral">'image/jpeg'</span>,
<a name="l00109"></a>00109                                    <span class="stringliteral">'bmp'</span>  =&gt; <span class="stringliteral">'image/bmp'</span>,
<a name="l00110"></a>00110                                    <span class="stringliteral">'png'</span>  =&gt; <span class="stringliteral">'image/png'</span>,
<a name="l00111"></a>00111                                    <span class="stringliteral">'tif'</span>  =&gt; <span class="stringliteral">'image/tiff'</span>,
<a name="l00112"></a>00112                                    <span class="stringliteral">'tiff'</span> =&gt; <span class="stringliteral">'image/tiff'</span>,
<a name="l00113"></a>00113                                    <span class="stringliteral">'swf'</span>  =&gt; <span class="stringliteral">'application/x-shockwave-flash'</span>);
<a name="l00114"></a>00114 
<a name="l00118"></a>00118         $this-&gt;build_params[<span class="stringliteral">'html_encoding'</span>] = <span class="keyword">new</span> <a class="code" href="classQPrintEncoding.html" title="Quoted Printable Encoding class.">QPrintEncoding</a>();
<a name="l00119"></a>00119         $this-&gt;build_params[<span class="stringliteral">'text_encoding'</span>] = <span class="keyword">new</span> <a class="code" href="classSevenBitEncoding.html" title="7Bit Encoding class">SevenBitEncoding</a>();
<a name="l00120"></a>00120         $this-&gt;build_params[<span class="stringliteral">'html_charset'</span>]  = <span class="stringliteral">'ISO-8859-1'</span>;
<a name="l00121"></a>00121         $this-&gt;build_params[<span class="stringliteral">'text_charset'</span>]  = <span class="stringliteral">'ISO-8859-1'</span>;
<a name="l00122"></a>00122         $this-&gt;build_params[<span class="stringliteral">'head_charset'</span>]  = <span class="stringliteral">'ISO-8859-1'</span>;
<a name="l00123"></a>00123         $this-&gt;build_params[<span class="stringliteral">'text_wrap'</span>]     = 998;
<a name="l00124"></a>00124 
<a name="l00128"></a>00128         <span class="keywordflow">if</span> (!empty($_SERVER[<span class="stringliteral">'HTTP_HOST'</span>])) {
<a name="l00129"></a>00129             $helo = $_SERVER[<span class="stringliteral">'HTTP_HOST'</span>];
<a name="l00130"></a>00130 
<a name="l00131"></a>00131         } elseif (!empty($_SERVER[<span class="stringliteral">'SERVER_NAME'</span>])) {
<a name="l00132"></a>00132             $helo = $_SERVER[<span class="stringliteral">'SERVER_NAME'</span>];
<a name="l00133"></a>00133         
<a name="l00134"></a>00134         } <span class="keywordflow">else</span> {
<a name="l00135"></a>00135             $helo = <span class="stringliteral">'localhost'</span>;
<a name="l00136"></a>00136         }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         $this-&gt;smtp_params[<span class="stringliteral">'host'</span>] = <span class="stringliteral">'localhost'</span>;
<a name="l00139"></a>00139         $this-&gt;smtp_params[<span class="stringliteral">'port'</span>] = 25;
<a name="l00140"></a>00140         $this-&gt;smtp_params[<span class="stringliteral">'helo'</span>] = $helo;
<a name="l00141"></a>00141         $this-&gt;smtp_params[<span class="stringliteral">'auth'</span>] = <span class="keyword">false</span>;
<a name="l00142"></a>00142         $this-&gt;smtp_params[<span class="stringliteral">'user'</span>] = <span class="stringliteral">''</span>;
<a name="l00143"></a>00143         $this-&gt;smtp_params[<span class="stringliteral">'pass'</span>] = <span class="stringliteral">''</span>;
<a name="l00144"></a>00144 
<a name="l00148"></a>00148         $this-&gt;headers[<span class="stringliteral">'MIME-Version'</span>] = <span class="stringliteral">'1.0'</span>;
<a name="l00149"></a>00149         $this-&gt;headers[<span class="stringliteral">'X-Mailer'</span>] = <span class="stringliteral">'Rmail &lt;http://www.phpguru.org/&gt;'</span>;
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151 
<a name="l00159"></a><a class="code" href="classRmail.html#758361a90532ff464e16c7aa557b7db1">00159</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#758361a90532ff464e16c7aa557b7db1" title="Accessor to set the CRLF style.">setCRLF</a>($crlf = <span class="stringliteral">"\n"</span>)
<a name="l00160"></a>00160     {
<a name="l00161"></a>00161         <span class="keywordflow">if</span> (!defined(<span class="stringliteral">'CRLF'</span>)) {
<a name="l00162"></a>00162             define(<span class="stringliteral">'CRLF'</span>, $crlf, <span class="keyword">true</span>);
<a name="l00163"></a>00163         }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="keywordflow">if</span> (!defined(<span class="stringliteral">'MAIL_MIMEPART_CRLF'</span>)) {
<a name="l00166"></a>00166             define(<span class="stringliteral">'MAIL_MIMEPART_CRLF'</span>, $crlf, <span class="keyword">true</span>);
<a name="l00167"></a>00167         }
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169 
<a name="l00180"></a><a class="code" href="classRmail.html#ace744770842386c910a83aa549614f7">00180</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#ace744770842386c910a83aa549614f7" title="Accessor to set the SMTP parameters.">setSMTPParams</a>($host = null, $port = null, $helo = null, $auth = null, $user = null, $pass = null)
<a name="l00181"></a>00181     {
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (!is_null($host)) $this-&gt;smtp_params[<span class="stringliteral">'host'</span>] = $host;
<a name="l00183"></a>00183         <span class="keywordflow">if</span> (!is_null($port)) $this-&gt;smtp_params[<span class="stringliteral">'port'</span>] = $port;
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (!is_null($helo)) $this-&gt;smtp_params[<span class="stringliteral">'helo'</span>] = $helo;
<a name="l00185"></a>00185         <span class="keywordflow">if</span> (!is_null($auth)) $this-&gt;smtp_params[<span class="stringliteral">'auth'</span>] = $auth;
<a name="l00186"></a>00186         <span class="keywordflow">if</span> (!is_null($user)) $this-&gt;smtp_params[<span class="stringliteral">'user'</span>] = $user;
<a name="l00187"></a>00187         <span class="keywordflow">if</span> (!is_null($pass)) $this-&gt;smtp_params[<span class="stringliteral">'pass'</span>] = $pass;
<a name="l00188"></a>00188     }
<a name="l00189"></a>00189 
<a name="l00195"></a><a class="code" href="classRmail.html#3f98b434e26e081941e7f1ccfcb7bb42">00195</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#3f98b434e26e081941e7f1ccfcb7bb42" title="Sets sendmail path and options (optionally) (when directly piping to sendmail).">setSendmailPath</a>($path)
<a name="l00196"></a>00196     {
<a name="l00197"></a>00197         $this-&gt;sendmail_path = $path;
<a name="l00198"></a>00198     }
<a name="l00199"></a>00199 
<a name="l00205"></a><a class="code" href="classRmail.html#064b50a4b453538e657375248fa63bf0">00205</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#064b50a4b453538e657375248fa63bf0" title="Accessor function to set the text encoding.">setTextEncoding</a>(<a class="code" href="interfaceiEncoding.html" title="Encoding interface.">iEncoding</a> $encoding)
<a name="l00206"></a>00206     {
<a name="l00207"></a>00207         $this-&gt;build_params[<span class="stringliteral">'text_encoding'</span>] = $encoding;
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209 
<a name="l00215"></a><a class="code" href="classRmail.html#f929ff1337b28358849d3fc6d525601d">00215</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#f929ff1337b28358849d3fc6d525601d" title="Accessor function to set the HTML encoding.">setHTMLEncoding</a>(<a class="code" href="interfaceiEncoding.html" title="Encoding interface.">iEncoding</a> $encoding)
<a name="l00216"></a>00216     {
<a name="l00217"></a>00217         $this-&gt;build_params[<span class="stringliteral">'html_encoding'</span>] = $encoding;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219     
<a name="l00225"></a><a class="code" href="classRmail.html#a2ac98b3b68acf7023c47fc6e52a89a6">00225</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#a2ac98b3b68acf7023c47fc6e52a89a6" title="Accessor function to set the text charset.">setTextCharset</a>($charset = <span class="stringliteral">'ISO-8859-1'</span>)
<a name="l00226"></a>00226     {
<a name="l00227"></a>00227         $this-&gt;build_params[<span class="stringliteral">'text_charset'</span>] = $charset;
<a name="l00228"></a>00228     }
<a name="l00229"></a>00229 
<a name="l00235"></a><a class="code" href="classRmail.html#757e19a1decfb8a382de7da84f3af76c">00235</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#757e19a1decfb8a382de7da84f3af76c" title="Accessor function to set the HTML charset.">setHTMLCharset</a>($charset = <span class="stringliteral">'ISO-8859-1'</span>)
<a name="l00236"></a>00236     {
<a name="l00237"></a>00237         $this-&gt;build_params[<span class="stringliteral">'html_charset'</span>] = $charset;
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239 
<a name="l00245"></a><a class="code" href="classRmail.html#fb1e8a4be8c05326cb33aaf3cf4a84fc">00245</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#fb1e8a4be8c05326cb33aaf3cf4a84fc" title="Accessor function to set the header encoding charset.">setHeadCharset</a>($charset = <span class="stringliteral">'ISO-8859-1'</span>)
<a name="l00246"></a>00246     {
<a name="l00247"></a>00247         $this-&gt;build_params[<span class="stringliteral">'head_charset'</span>] = $charset;
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249 
<a name="l00255"></a><a class="code" href="classRmail.html#96721636fe71d9d6591c4ca30fcc18f4">00255</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#96721636fe71d9d6591c4ca30fcc18f4" title="Accessor function to set the text wrap count.">setTextWrap</a>($count = 998)
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257         $this-&gt;build_params[<span class="stringliteral">'text_wrap'</span>] = $count;
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259 
<a name="l00266"></a><a class="code" href="classRmail.html#2d3d8d43cbe52259d77c3125342e3656">00266</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#2d3d8d43cbe52259d77c3125342e3656" title="Accessor to set a header.">setHeader</a>($name, $value)
<a name="l00267"></a>00267     {
<a name="l00268"></a>00268         $this-&gt;headers[$name] = $value;
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270     
<a name="l00278"></a><a class="code" href="classRmail.html#edb31e892167cbfeb48ca0b1f9d44d10">00278</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#edb31e892167cbfeb48ca0b1f9d44d10" title="Sets the delivery reciept address.">setReceipt</a>($email)
<a name="l00279"></a>00279     {
<a name="l00280"></a>00280         $this-&gt;headers[<span class="stringliteral">'Disposition-Notification-To'</span>] = $email;
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282 
<a name="l00288"></a><a class="code" href="classRmail.html#e67826ed76feaa48fa00bb1ee7328e96">00288</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#e67826ed76feaa48fa00bb1ee7328e96" title="Accessor to add a Subject: header.">setSubject</a>($subject)
<a name="l00289"></a>00289     {
<a name="l00290"></a>00290         $this-&gt;headers[<span class="stringliteral">'Subject'</span>] = $subject;
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 
<a name="l00298"></a><a class="code" href="classRmail.html#a72d8f570d173329bab70a51f98bf842">00298</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#a72d8f570d173329bab70a51f98bf842" title="Accessor to add a From: header.">setFrom</a>($from)
<a name="l00299"></a>00299     {
<a name="l00300"></a>00300         $this-&gt;headers[<span class="stringliteral">'From'</span>] = $from;
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302     
<a name="l00310"></a><a class="code" href="classRmail.html#d51d02118c151e7dbf0a1b6a28dc8e94">00310</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#d51d02118c151e7dbf0a1b6a28dc8e94" title="Accessor to set priority.">setPriority</a>($priority = <span class="stringliteral">'normal'</span>)
<a name="l00311"></a>00311     {
<a name="l00312"></a>00312         <span class="keywordflow">switch</span> (strtolower($priority)) {
<a name="l00313"></a>00313             <span class="keywordflow">case</span> <span class="stringliteral">'high'</span>:
<a name="l00314"></a>00314             <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
<a name="l00315"></a>00315                 $this-&gt;headers[<span class="stringliteral">'X-Priority'</span>] = <span class="charliteral">'1'</span>;
<a name="l00316"></a>00316                 $this-&gt;headers[<span class="stringliteral">'X-MSMail-Priority'</span>] = <span class="stringliteral">'High'</span>;
<a name="l00317"></a>00317                 <span class="keywordflow">break</span>;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319             <span class="keywordflow">case</span> <span class="stringliteral">'normal'</span>:
<a name="l00320"></a>00320             <span class="keywordflow">case</span> <span class="charliteral">'3'</span>:
<a name="l00321"></a>00321                 $this-&gt;headers[<span class="stringliteral">'X-Priority'</span>] = <span class="charliteral">'3'</span>;
<a name="l00322"></a>00322                 $this-&gt;headers[<span class="stringliteral">'X-MSMail-Priority'</span>] = <span class="stringliteral">'Normal'</span>;
<a name="l00323"></a>00323                 <span class="keywordflow">break</span>;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325             <span class="keywordflow">case</span> <span class="stringliteral">'low'</span>:
<a name="l00326"></a>00326             <span class="keywordflow">case</span> <span class="charliteral">'5'</span>:
<a name="l00327"></a>00327                 $this-&gt;headers[<span class="stringliteral">'X-Priority'</span>] = <span class="charliteral">'5'</span>;
<a name="l00328"></a>00328                 $this-&gt;headers[<span class="stringliteral">'X-MSMail-Priority'</span>] = <span class="stringliteral">'Low'</span>;
<a name="l00329"></a>00329                 <span class="keywordflow">break</span>;
<a name="l00330"></a>00330         }
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332 
<a name="l00338"></a><a class="code" href="classRmail.html#6cf0cb9ee005da8ebccf622898898a3e">00338</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#6cf0cb9ee005da8ebccf622898898a3e" title="Accessor to set the return path.">setReturnPath</a>(<a class="code" href="classRmail.html#276d1322b32d90380a5df460ea44212a" title="The return path address.">$return_path</a>)
<a name="l00339"></a>00339     {
<a name="l00340"></a>00340         $this-&gt;return_path = <a class="code" href="classRmail.html#276d1322b32d90380a5df460ea44212a" title="The return path address.">$return_path</a>;
<a name="l00341"></a>00341     }
<a name="l00342"></a>00342 
<a name="l00348"></a><a class="code" href="classRmail.html#67bf5d6198d3771c7e45462dfed6892d">00348</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#67bf5d6198d3771c7e45462dfed6892d" title="Accessor to add a Cc: header.">setCc</a>($cc)
<a name="l00349"></a>00349     {
<a name="l00350"></a>00350         $this-&gt;headers[<span class="stringliteral">'Cc'</span>] = $cc;
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352 
<a name="l00358"></a><a class="code" href="classRmail.html#e585f6d82e03e32fa97f3bc8979d2c3d">00358</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#e585f6d82e03e32fa97f3bc8979d2c3d" title="Accessor to add a Bcc: header.">setBcc</a>($bcc)
<a name="l00359"></a>00359     {
<a name="l00360"></a>00360         $this-&gt;headers[<span class="stringliteral">'Bcc'</span>] = $bcc;
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362 
<a name="l00369"></a><a class="code" href="classRmail.html#c184bdbbdc8251c30271f00a919a439f">00369</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#c184bdbbdc8251c30271f00a919a439f" title="Adds plain text.">setText</a>(<a class="code" href="classRmail.html#a808be34d284f78a5bcfefc833a68da0" title="The text part of the message(only used in TEXT only messages) string.">$text</a>)
<a name="l00370"></a>00370     {
<a name="l00371"></a>00371         $this-&gt;text = <a class="code" href="classRmail.html#a808be34d284f78a5bcfefc833a68da0" title="The text part of the message(only used in TEXT only messages) string.">$text</a>;
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373 
<a name="l00382"></a><a class="code" href="classRmail.html#1b0da23f33161bf9bb6f53f888219f5c">00382</a>     function <a class="code" href="classRmail.html#1b0da23f33161bf9bb6f53f888219f5c" title="Adds HTML to the emails, with an associated text part.">setHTML</a>(<a class="code" href="classRmail.html#12a455cf50018a43f2668f91bf62b727">$html</a>, $images_dir = null)
<a name="l00383"></a>00383     {
<a name="l00384"></a>00384         $this-&gt;html = <a class="code" href="classRmail.html#12a455cf50018a43f2668f91bf62b727">$html</a>;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386         <span class="keywordflow">if</span> (!empty($images_dir)) {
<a name="l00387"></a>00387             $this-&gt;<a class="code" href="classRmail.html#d990fa5be0c30ee9c5ad4a5ecd7c5da8" title="Function for extracting images from html source.">findHtmlImages</a>($images_dir);
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389     }
<a name="l00390"></a>00390 
<a name="l00402"></a><a class="code" href="classRmail.html#d990fa5be0c30ee9c5ad4a5ecd7c5da8">00402</a>     <span class="keyword">private</span> function <a class="code" href="classRmail.html#d990fa5be0c30ee9c5ad4a5ecd7c5da8" title="Function for extracting images from html source.">findHtmlImages</a>($images_dir)
<a name="l00403"></a>00403     {
<a name="l00404"></a>00404         <span class="comment">// Build the list of image extensions</span>
<a name="l00405"></a>00405         $extensions = array_keys($this-&gt;image_types);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407         preg_match_all(<span class="stringliteral">'/(?:"|\')([^"\']+\.('</span>.implode(<span class="charliteral">'|'</span>, $extensions).<span class="stringliteral">'))(?:"|\')/Ui'</span>, $this-&gt;html, $matches);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409         <span class="keywordflow">foreach</span> ($matches[1] as $m) {
<a name="l00410"></a>00410             <span class="keywordflow">if</span> (file_exists($images_dir . $m)) {
<a name="l00411"></a>00411                 <a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a>[] = $m;
<a name="l00412"></a>00412                 $this-&gt;html = str_replace($m, basename($m), $this-&gt;html);
<a name="l00413"></a>00413             }
<a name="l00414"></a>00414         }
<a name="l00415"></a>00415 
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (!empty(<a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a>)) {
<a name="l00420"></a>00420 
<a name="l00421"></a>00421             <span class="comment">// If duplicate images are embedded, they may show up as attachments, so remove them.</span>
<a name="l00422"></a>00422             <a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a> = array_unique(<a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a>);
<a name="l00423"></a>00423             sort(<a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a>);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425             <span class="keywordflow">foreach</span> (<a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a> as $img) {
<a name="l00426"></a>00426                 <span class="keywordflow">if</span> ($image = file_get_contents($images_dir . $img)) {
<a name="l00427"></a>00427                     $ext          = preg_replace(<span class="stringliteral">'#^.*\.(\w{3,4})$#e'</span>, <span class="stringliteral">'strtolower("$1")'</span>, $img);
<a name="l00428"></a>00428                     $content_type = $this-&gt;image_types[$ext];
<a name="l00429"></a>00429                     $this-&gt;<a class="code" href="classRmail.html#5a60edea8d457da9f3093d01d93c4cdb" title="Adds an image to the list of embedded images.">addEmbeddedImage</a>(<span class="keyword">new</span> <a class="code" href="classstringEmbeddedImage.html" title="String based embedded image class.">stringEmbeddedImage</a>($image, basename($img), $content_type));
<a name="l00430"></a>00430                 }
<a name="l00431"></a>00431             }
<a name="l00432"></a>00432         }
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434 
<a name="l00441"></a><a class="code" href="classRmail.html#5a60edea8d457da9f3093d01d93c4cdb">00441</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#5a60edea8d457da9f3093d01d93c4cdb" title="Adds an image to the list of embedded images.">addEmbeddedImage</a>($embeddedImage)
<a name="l00442"></a>00442     {
<a name="l00443"></a>00443         $embeddedImage-&gt;cid = md5(uniqid(time()));
<a name="l00444"></a>00444 
<a name="l00445"></a>00445         $this-&gt;html_images[] = $embeddedImage;
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 
<a name="l00454"></a><a class="code" href="classRmail.html#d1acff1ba296711b169a3d56eaa076b6">00454</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#d1acff1ba296711b169a3d56eaa076b6" title="Adds a file to the list of attachments.">addAttachment</a>(<a class="code" href="example2_8php.html#4019bc6f2f49dc44acb1b4168505b19e" title="o------------------------------------------------------------------------------o...">$attachment</a>)
<a name="l00455"></a>00455     {
<a name="l00456"></a>00456         $this-&gt;attachments[] = <a class="code" href="example2_8php.html#4019bc6f2f49dc44acb1b4168505b19e" title="o------------------------------------------------------------------------------o...">$attachment</a>;
<a name="l00457"></a>00457     }
<a name="l00458"></a>00458 
<a name="l00465"></a><a class="code" href="classRmail.html#a5b5950618c03fb841f68640df9ca369">00465</a>     <span class="keyword">private</span> function <a class="code" href="classRmail.html#a5b5950618c03fb841f68640df9ca369" title="Adds a text subpart to a mime_part object.">addTextPart</a>(&amp;$message)
<a name="l00466"></a>00466     {
<a name="l00467"></a>00467         $params[<span class="stringliteral">'content_type'</span>] = <span class="stringliteral">'text/plain'</span>;
<a name="l00468"></a>00468         $params[<span class="stringliteral">'encoding'</span>]     = $this-&gt;build_params[<span class="stringliteral">'text_encoding'</span>]-&gt;getType();
<a name="l00469"></a>00469         $params[<span class="stringliteral">'charset'</span>]      = $this-&gt;build_params[<span class="stringliteral">'text_charset'</span>];
<a name="l00470"></a>00470 
<a name="l00471"></a>00471         <span class="keywordflow">if</span> (!empty($message)) {
<a name="l00472"></a>00472             $message-&gt;addSubpart($this-&gt;text, $params);
<a name="l00473"></a>00473         } <span class="keywordflow">else</span> {
<a name="l00474"></a>00474             $message = <span class="keyword">new</span> Mail_mimePart($this-&gt;text, $params);
<a name="l00475"></a>00475         }
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 
<a name="l00484"></a><a class="code" href="classRmail.html#461118a77c1088d9eb97028136ae9d93">00484</a>     <span class="keyword">private</span> function <a class="code" href="classRmail.html#461118a77c1088d9eb97028136ae9d93" title="Adds a html subpart to a mime_part object.">addHtmlPart</a>(&amp;$message)
<a name="l00485"></a>00485     {
<a name="l00486"></a>00486         $params[<span class="stringliteral">'content_type'</span>] = <span class="stringliteral">'text/html'</span>;
<a name="l00487"></a>00487         $params[<span class="stringliteral">'encoding'</span>]     = $this-&gt;build_params[<span class="stringliteral">'html_encoding'</span>]-&gt;getType();
<a name="l00488"></a>00488         $params[<span class="stringliteral">'charset'</span>]      = $this-&gt;build_params[<span class="stringliteral">'html_charset'</span>];
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="keywordflow">if</span> (!empty($message)) {
<a name="l00491"></a>00491             $message-&gt;addSubpart($this-&gt;html, $params);
<a name="l00492"></a>00492         } <span class="keywordflow">else</span> {
<a name="l00493"></a>00493             $message = <span class="keyword">new</span> Mail_mimePart($this-&gt;html, $params);
<a name="l00494"></a>00494         }
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496 
<a name="l00502"></a><a class="code" href="classRmail.html#dd80ceea3f7f63bf6f30f0382641afbe">00502</a>     <span class="keyword">private</span> function <a class="code" href="classRmail.html#dd80ceea3f7f63bf6f30f0382641afbe" title="Starts a message with a mixed part.">addMixedPart</a>(&amp;$message)
<a name="l00503"></a>00503     {
<a name="l00504"></a>00504         $params[<span class="stringliteral">'content_type'</span>] = <span class="stringliteral">'multipart/mixed'</span>;
<a name="l00505"></a>00505         
<a name="l00506"></a>00506         $message = <span class="keyword">new</span> Mail_mimePart(<span class="stringliteral">''</span>, $params);
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508 
<a name="l00515"></a><a class="code" href="classRmail.html#53a3f7e166f7e81c04ea35e499d62138">00515</a>     <span class="keyword">private</span> function <a class="code" href="classRmail.html#53a3f7e166f7e81c04ea35e499d62138" title="Adds an alternative part to a mime_part object.">addAlternativePart</a>(&amp;$message)
<a name="l00516"></a>00516     {
<a name="l00517"></a>00517         $params[<span class="stringliteral">'content_type'</span>] = <span class="stringliteral">'multipart/alternative'</span>;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519         <span class="keywordflow">if</span> (!empty($message)) {
<a name="l00520"></a>00520             <span class="keywordflow">return</span> $message-&gt;addSubpart(<span class="stringliteral">''</span>, $params);
<a name="l00521"></a>00521         } <span class="keywordflow">else</span> {
<a name="l00522"></a>00522             $message = <span class="keyword">new</span> Mail_mimePart(<span class="stringliteral">''</span>, $params);
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525 
<a name="l00532"></a><a class="code" href="classRmail.html#051927b4f0514c4e238dd14204557e7f">00532</a>     <span class="keyword">private</span> function <a class="code" href="classRmail.html#051927b4f0514c4e238dd14204557e7f" title="Adds a html subpart to a mime_part object.">addRelatedPart</a>(&amp;$message)
<a name="l00533"></a>00533     {
<a name="l00534"></a>00534         $params[<span class="stringliteral">'content_type'</span>] = <span class="stringliteral">'multipart/related'</span>;
<a name="l00535"></a>00535 
<a name="l00536"></a>00536         <span class="keywordflow">if</span> (!empty($message)) {
<a name="l00537"></a>00537             <span class="keywordflow">return</span> $message-&gt;addSubpart(<span class="stringliteral">''</span>, $params);
<a name="l00538"></a>00538         } <span class="keywordflow">else</span> {
<a name="l00539"></a>00539             $message = <span class="keyword">new</span> Mail_mimePart(<span class="stringliteral">''</span>, $params);
<a name="l00540"></a>00540         }
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 
<a name="l00548"></a><a class="code" href="classRmail.html#4c152c3e83e1eb1712e44e4450aae7b6">00548</a>     <span class="keyword">private</span> function <a class="code" href="classRmail.html#4c152c3e83e1eb1712e44e4450aae7b6" title="Adds all html images to a mime_part object.">addHtmlImageParts</a>(&amp;$message)
<a name="l00549"></a>00549     {
<a name="l00550"></a>00550         <span class="keywordflow">foreach</span> ($this-&gt;html_images as $value) {
<a name="l00551"></a>00551             $params[<span class="stringliteral">'content_type'</span>] = $value-&gt;contentType;
<a name="l00552"></a>00552             $params[<span class="stringliteral">'encoding'</span>]     = $value-&gt;encoding-&gt;getType();
<a name="l00553"></a>00553             $params[<span class="stringliteral">'disposition'</span>]  = <span class="stringliteral">'inline'</span>;
<a name="l00554"></a>00554             $params[<span class="stringliteral">'dfilename'</span>]    = $value-&gt;name;
<a name="l00555"></a>00555             $params[<span class="stringliteral">'cid'</span>]          = $value-&gt;cid;
<a name="l00556"></a>00556     
<a name="l00557"></a>00557             $message-&gt;addSubpart($value-&gt;data, $params);
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560 
<a name="l00566"></a><a class="code" href="classRmail.html#3de905f092b78a325c933254fa1d5253">00566</a>     <span class="keyword">private</span> function <a class="code" href="classRmail.html#3de905f092b78a325c933254fa1d5253" title="Adds all attachments to a mime_part object.">addAttachmentParts</a>(&amp;$message)
<a name="l00567"></a>00567     {
<a name="l00568"></a>00568         <span class="keywordflow">foreach</span> ($this-&gt;attachments as $value) {
<a name="l00569"></a>00569             $params[<span class="stringliteral">'content_type'</span>] = $value-&gt;contentType;
<a name="l00570"></a>00570             $params[<span class="stringliteral">'encoding'</span>]     = $value-&gt;encoding-&gt;getType();
<a name="l00571"></a>00571             $params[<span class="stringliteral">'disposition'</span>]  = <span class="stringliteral">'attachment'</span>;
<a name="l00572"></a>00572             $params[<span class="stringliteral">'dfilename'</span>]    = $value-&gt;name;
<a name="l00573"></a>00573         
<a name="l00574"></a>00574             $message-&gt;addSubpart($value-&gt;data, $params);
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577 
<a name="l00581"></a><a class="code" href="classRmail.html#09e5cbded6e5a3c6ccde71d5963572f1">00581</a>     <span class="keyword">private</span> function <a class="code" href="classRmail.html#09e5cbded6e5a3c6ccde71d5963572f1" title="Builds the multipart message.">build</a>()
<a name="l00582"></a>00582     {
<a name="l00583"></a>00583         <span class="keywordflow">if</span> (!empty($this-&gt;html_images)) {
<a name="l00584"></a>00584             <span class="keywordflow">foreach</span> ($this-&gt;html_images as $value) {
<a name="l00585"></a>00585                 $quoted = preg_quote($value-&gt;name);
<a name="l00586"></a>00586                 $cid    = preg_quote($value-&gt;cid);
<a name="l00587"></a>00587 
<a name="l00588"></a>00588                 $this-&gt;html = preg_replace(<span class="stringliteral">"#src=\"$quoted\"|src='$quoted'#"</span>, <span class="stringliteral">"src=\"cid:$cid\""</span>, $this-&gt;html);
<a name="l00589"></a>00589                 $this-&gt;html = preg_replace(<span class="stringliteral">"#background=\"$quoted\"|background='$quoted'#"</span>, <span class="stringliteral">"background=\"cid:$cid\""</span>, $this-&gt;html);
<a name="l00590"></a>00590             }
<a name="l00591"></a>00591         }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593         $message     = null;
<a name="l00594"></a>00594         <a class="code" href="classRmail.html#2765b590dba786bb1b621d0a3142b8ab" title="Array of attachments array.">$attachments</a> = !empty($this-&gt;attachments);
<a name="l00595"></a>00595         <a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a> = !empty($this-&gt;html_images);
<a name="l00596"></a>00596         <a class="code" href="classRmail.html#12a455cf50018a43f2668f91bf62b727">$html</a>        = !empty($this-&gt;html);
<a name="l00597"></a>00597         <a class="code" href="classRmail.html#a808be34d284f78a5bcfefc833a68da0" title="The text part of the message(only used in TEXT only messages) string.">$text</a>        = !<a class="code" href="classRmail.html#12a455cf50018a43f2668f91bf62b727">$html</a>;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599         <span class="keywordflow">switch</span> (<span class="keyword">true</span>) {
<a name="l00600"></a>00600             <span class="keywordflow">case</span> <a class="code" href="classRmail.html#a808be34d284f78a5bcfefc833a68da0" title="The text part of the message(only used in TEXT only messages) string.">$text</a>:
<a name="l00601"></a>00601                 $message = null;
<a name="l00602"></a>00602                 <span class="keywordflow">if</span> (<a class="code" href="classRmail.html#2765b590dba786bb1b621d0a3142b8ab" title="Array of attachments array.">$attachments</a>) {
<a name="l00603"></a>00603                     $this-&gt;<a class="code" href="classRmail.html#dd80ceea3f7f63bf6f30f0382641afbe" title="Starts a message with a mixed part.">addMixedPart</a>($message);
<a name="l00604"></a>00604                 }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606                 $this-&gt;<a class="code" href="classRmail.html#a5b5950618c03fb841f68640df9ca369" title="Adds a text subpart to a mime_part object.">addTextPart</a>($message);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608                 <span class="comment">// Attachments</span>
<a name="l00609"></a>00609                 $this-&gt;<a class="code" href="classRmail.html#3de905f092b78a325c933254fa1d5253" title="Adds all attachments to a mime_part object.">addAttachmentParts</a>($message);
<a name="l00610"></a>00610                 <span class="keywordflow">break</span>;
<a name="l00611"></a>00611 
<a name="l00612"></a>00612             <span class="keywordflow">case</span> <a class="code" href="classRmail.html#12a455cf50018a43f2668f91bf62b727">$html</a> AND !<a class="code" href="classRmail.html#2765b590dba786bb1b621d0a3142b8ab" title="Array of attachments array.">$attachments</a> AND !<a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a>:
<a name="l00613"></a>00613                 $this-&gt;<a class="code" href="classRmail.html#53a3f7e166f7e81c04ea35e499d62138" title="Adds an alternative part to a mime_part object.">addAlternativePart</a>($message);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615                 $this-&gt;<a class="code" href="classRmail.html#a5b5950618c03fb841f68640df9ca369" title="Adds a text subpart to a mime_part object.">addTextPart</a>($message);
<a name="l00616"></a>00616                 $this-&gt;<a class="code" href="classRmail.html#461118a77c1088d9eb97028136ae9d93" title="Adds a html subpart to a mime_part object.">addHtmlPart</a>($message);
<a name="l00617"></a>00617                 <span class="keywordflow">break</span>;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619             <span class="keywordflow">case</span> <a class="code" href="classRmail.html#12a455cf50018a43f2668f91bf62b727">$html</a> AND !<a class="code" href="classRmail.html#2765b590dba786bb1b621d0a3142b8ab" title="Array of attachments array.">$attachments</a> AND <a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a>:
<a name="l00620"></a>00620                 $this-&gt;<a class="code" href="classRmail.html#051927b4f0514c4e238dd14204557e7f" title="Adds a html subpart to a mime_part object.">addRelatedPart</a>($message);
<a name="l00621"></a>00621                 $alt = $this-&gt;<a class="code" href="classRmail.html#53a3f7e166f7e81c04ea35e499d62138" title="Adds an alternative part to a mime_part object.">addAlternativePart</a>($message);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623                 $this-&gt;<a class="code" href="classRmail.html#a5b5950618c03fb841f68640df9ca369" title="Adds a text subpart to a mime_part object.">addTextPart</a>($alt);
<a name="l00624"></a>00624                 $this-&gt;<a class="code" href="classRmail.html#461118a77c1088d9eb97028136ae9d93" title="Adds a html subpart to a mime_part object.">addHtmlPart</a>($alt);
<a name="l00625"></a>00625                 
<a name="l00626"></a>00626                 <span class="comment">// HTML images</span>
<a name="l00627"></a>00627                 $this-&gt;<a class="code" href="classRmail.html#4c152c3e83e1eb1712e44e4450aae7b6" title="Adds all html images to a mime_part object.">addHtmlImageParts</a>($message);
<a name="l00628"></a>00628                 <span class="keywordflow">break</span>;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630             <span class="keywordflow">case</span> <a class="code" href="classRmail.html#12a455cf50018a43f2668f91bf62b727">$html</a> AND <a class="code" href="classRmail.html#2765b590dba786bb1b621d0a3142b8ab" title="Array of attachments array.">$attachments</a> AND !<a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a>:
<a name="l00631"></a>00631                 $this-&gt;<a class="code" href="classRmail.html#dd80ceea3f7f63bf6f30f0382641afbe" title="Starts a message with a mixed part.">addMixedPart</a>($message);
<a name="l00632"></a>00632                 $alt = $this-&gt;<a class="code" href="classRmail.html#53a3f7e166f7e81c04ea35e499d62138" title="Adds an alternative part to a mime_part object.">addAlternativePart</a>($message);
<a name="l00633"></a>00633 
<a name="l00634"></a>00634                 $this-&gt;<a class="code" href="classRmail.html#a5b5950618c03fb841f68640df9ca369" title="Adds a text subpart to a mime_part object.">addTextPart</a>($alt);
<a name="l00635"></a>00635                 $this-&gt;<a class="code" href="classRmail.html#461118a77c1088d9eb97028136ae9d93" title="Adds a html subpart to a mime_part object.">addHtmlPart</a>($alt);
<a name="l00636"></a>00636                 
<a name="l00637"></a>00637                 <span class="comment">// Attachments</span>
<a name="l00638"></a>00638                 $this-&gt;<a class="code" href="classRmail.html#3de905f092b78a325c933254fa1d5253" title="Adds all attachments to a mime_part object.">addAttachmentParts</a>($message);
<a name="l00639"></a>00639                 <span class="keywordflow">break</span>;
<a name="l00640"></a>00640 
<a name="l00641"></a>00641             <span class="keywordflow">case</span> <a class="code" href="classRmail.html#12a455cf50018a43f2668f91bf62b727">$html</a> AND <a class="code" href="classRmail.html#2765b590dba786bb1b621d0a3142b8ab" title="Array of attachments array.">$attachments</a> AND <a class="code" href="classRmail.html#9050252f46197523a890385326341696" title="An array of embedded images /objects array.">$html_images</a>:
<a name="l00642"></a>00642                 $this-&gt;<a class="code" href="classRmail.html#dd80ceea3f7f63bf6f30f0382641afbe" title="Starts a message with a mixed part.">addMixedPart</a>($message);
<a name="l00643"></a>00643                 $rel = $this-&gt;<a class="code" href="classRmail.html#051927b4f0514c4e238dd14204557e7f" title="Adds a html subpart to a mime_part object.">addRelatedPart</a>($message);
<a name="l00644"></a>00644                 $alt = $this-&gt;<a class="code" href="classRmail.html#53a3f7e166f7e81c04ea35e499d62138" title="Adds an alternative part to a mime_part object.">addAlternativePart</a>($rel);
<a name="l00645"></a>00645                 
<a name="l00646"></a>00646                 $this-&gt;<a class="code" href="classRmail.html#a5b5950618c03fb841f68640df9ca369" title="Adds a text subpart to a mime_part object.">addTextPart</a>($alt);
<a name="l00647"></a>00647                 $this-&gt;<a class="code" href="classRmail.html#461118a77c1088d9eb97028136ae9d93" title="Adds a html subpart to a mime_part object.">addHtmlPart</a>($alt);
<a name="l00648"></a>00648                 
<a name="l00649"></a>00649                 <span class="comment">// HTML images</span>
<a name="l00650"></a>00650                 $this-&gt;<a class="code" href="classRmail.html#4c152c3e83e1eb1712e44e4450aae7b6" title="Adds all html images to a mime_part object.">addHtmlImageParts</a>($rel);
<a name="l00651"></a>00651                 
<a name="l00652"></a>00652                 <span class="comment">// Attachments</span>
<a name="l00653"></a>00653                 $this-&gt;<a class="code" href="classRmail.html#3de905f092b78a325c933254fa1d5253" title="Adds all attachments to a mime_part object.">addAttachmentParts</a>($message);
<a name="l00654"></a>00654                 <span class="keywordflow">break</span>;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656         }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658         <span class="keywordflow">if</span> (isset($message)) {
<a name="l00659"></a>00659             <a class="code" href="classRmail.html#872ba801333240c5e3243ad00d48110a" title="The main body of the message after building string.">$output</a> = $message-&gt;encode();
<a name="l00660"></a>00660             $this-&gt;output   = <a class="code" href="classRmail.html#872ba801333240c5e3243ad00d48110a" title="The main body of the message after building string.">$output</a>[<span class="stringliteral">'body'</span>];
<a name="l00661"></a>00661             $this-&gt;headers  = array_merge($this-&gt;headers, <a class="code" href="classRmail.html#872ba801333240c5e3243ad00d48110a" title="The main body of the message after building string.">$output</a>[<span class="stringliteral">'headers'</span>]);
<a name="l00662"></a>00662 
<a name="l00663"></a>00663             <span class="comment">// Figure out hostname</span>
<a name="l00664"></a>00664             <span class="keywordflow">if</span> (!empty($_SERVER[<span class="stringliteral">'HTTP_HOST'</span>])) {
<a name="l00665"></a>00665                 $hostname = $_SERVER[<span class="stringliteral">'HTTP_HOST'</span>];
<a name="l00666"></a>00666             
<a name="l00667"></a>00667             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!empty($_SERVER[<span class="stringliteral">'SERVER_NAME'</span>])) {
<a name="l00668"></a>00668                 $hostname = $_SERVER[<span class="stringliteral">'SERVER_NAME'</span>];
<a name="l00669"></a>00669             
<a name="l00670"></a>00670             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!empty($_ENV[<span class="stringliteral">'HOSTNAME'</span>])) {
<a name="l00671"></a>00671                 $hostname = $_ENV[<span class="stringliteral">'HOSTNAME'</span>];
<a name="l00672"></a>00672             
<a name="l00673"></a>00673             } <span class="keywordflow">else</span> {
<a name="l00674"></a>00674                 $hostname = <span class="stringliteral">'localhost'</span>;
<a name="l00675"></a>00675             }
<a name="l00676"></a>00676             
<a name="l00677"></a>00677             $message_id = sprintf(<span class="stringliteral">'&lt;%s.%s@%s&gt;'</span>, base_convert(time(), 10, 36), base_convert(rand(), 10, 36), $hostname);
<a name="l00678"></a>00678             $this-&gt;headers[<span class="stringliteral">'Message-ID'</span>] = $message_id;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00681"></a>00681         } <span class="keywordflow">else</span> {
<a name="l00682"></a>00682             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00683"></a>00683         }
<a name="l00684"></a>00684     }
<a name="l00685"></a>00685 
<a name="l00694"></a><a class="code" href="classRmail.html#bd56ea9b417fbaceafeca8e0ba6d76b7">00694</a>     <span class="keyword">private</span> function <a class="code" href="classRmail.html#bd56ea9b417fbaceafeca8e0ba6d76b7" title="Function to encode a header if necessary according to RFC2047.">encodeHeader</a>($input, $charset = <span class="stringliteral">'ISO-8859-1'</span>)
<a name="l00695"></a>00695     {
<a name="l00696"></a>00696         preg_match_all(<span class="stringliteral">'/(\w*[\x80-\xFF]+\w*)/'</span>, $input, $matches);
<a name="l00697"></a>00697         <span class="keywordflow">foreach</span> ($matches[1] as $value) {
<a name="l00698"></a>00698             $replacement = preg_replace(<span class="stringliteral">'/([\x80-\xFF])/e'</span>, <span class="stringliteral">'"=" . strtoupper(dechex(ord("\1")))'</span>, $value);
<a name="l00699"></a>00699             $input = str_replace($value, <span class="stringliteral">'=?'</span> . $charset . <span class="stringliteral">'?Q?'</span> . $replacement . <span class="stringliteral">'?='</span>, $input);
<a name="l00700"></a>00700         }
<a name="l00701"></a>00701         
<a name="l00702"></a>00702         <span class="keywordflow">return</span> $input;
<a name="l00703"></a>00703     }
<a name="l00704"></a>00704 
<a name="l00712"></a><a class="code" href="classRmail.html#5db1c455f17d17d920cf03536d5cf7b3">00712</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#5db1c455f17d17d920cf03536d5cf7b3" title="Sends the mail.">send</a>($recipients, $type = <span class="stringliteral">'mail'</span>)
<a name="l00713"></a>00713     {
<a name="l00714"></a>00714         <span class="keywordflow">if</span> (!defined(<span class="stringliteral">'CRLF'</span>)) {
<a name="l00715"></a>00715             $this-&gt;<a class="code" href="classRmail.html#758361a90532ff464e16c7aa557b7db1" title="Accessor to set the CRLF style.">setCRLF</a>( ($type == <span class="stringliteral">'mail'</span> OR $type == <span class="stringliteral">'sendmail'</span>) ? <span class="stringliteral">"\n"</span> : <span class="stringliteral">"\r\n"</span>);
<a name="l00716"></a>00716         }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718         $this-&gt;<a class="code" href="classRmail.html#09e5cbded6e5a3c6ccde71d5963572f1" title="Builds the multipart message.">build</a>();
<a name="l00719"></a>00719 
<a name="l00720"></a>00720         <span class="keywordflow">switch</span> ($type) {
<a name="l00721"></a>00721             <span class="keywordflow">case</span> <span class="stringliteral">'mail'</span>:
<a name="l00722"></a>00722                 $subject = <span class="stringliteral">''</span>;
<a name="l00723"></a>00723                 <span class="keywordflow">if</span> (!empty($this-&gt;headers[<span class="stringliteral">'Subject'</span>])) {
<a name="l00724"></a>00724                     $subject = $this-&gt;<a class="code" href="classRmail.html#bd56ea9b417fbaceafeca8e0ba6d76b7" title="Function to encode a header if necessary according to RFC2047.">encodeHeader</a>($this-&gt;headers[<span class="stringliteral">'Subject'</span>], $this-&gt;build_params[<span class="stringliteral">'head_charset'</span>]);
<a name="l00725"></a>00725                     unset($this-&gt;headers[<span class="stringliteral">'Subject'</span>]);
<a name="l00726"></a>00726                 }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728                 <span class="comment">// Get flat representation of headers</span>
<a name="l00729"></a>00729                 <span class="keywordflow">foreach</span> ($this-&gt;headers as $name =&gt; $value) {
<a name="l00730"></a>00730                     <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>[] = $name . <span class="stringliteral">': '</span> . $this-&gt;<a class="code" href="classRmail.html#bd56ea9b417fbaceafeca8e0ba6d76b7" title="Function to encode a header if necessary according to RFC2047.">encodeHeader</a>($value, $this-&gt;build_params[<span class="stringliteral">'head_charset'</span>]);
<a name="l00731"></a>00731                 }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733                 $to = $this-&gt;<a class="code" href="classRmail.html#bd56ea9b417fbaceafeca8e0ba6d76b7" title="Function to encode a header if necessary according to RFC2047.">encodeHeader</a>(implode(<span class="stringliteral">', '</span>, $recipients), $this-&gt;build_params[<span class="stringliteral">'head_charset'</span>]);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735                 <span class="keywordflow">if</span> (!empty($this-&gt;return_path)) {
<a name="l00736"></a>00736                     <a class="code" href="example_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mail($to, $subject, $this-&gt;output, implode(CRLF, <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>), <span class="stringliteral">'-f'</span> . $this-&gt;return_path);
<a name="l00737"></a>00737                 } <span class="keywordflow">else</span> {
<a name="l00738"></a>00738                     <a class="code" href="example_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mail($to, $subject, $this-&gt;output, implode(CRLF, <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>));
<a name="l00739"></a>00739                 }
<a name="l00740"></a>00740 
<a name="l00741"></a>00741                 <span class="comment">// Reset the subject in case mail is resent</span>
<a name="l00742"></a>00742                 <span class="keywordflow">if</span> ($subject !== <span class="stringliteral">''</span>) {
<a name="l00743"></a>00743                     $this-&gt;headers[<span class="stringliteral">'Subject'</span>] = $subject;
<a name="l00744"></a>00744                 }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746 
<a name="l00747"></a>00747                 <span class="comment">// Return</span>
<a name="l00748"></a>00748                 <span class="keywordflow">return</span> <a class="code" href="example_8php.html#112ef069ddc0454086e3d1e6d8d55d07">$result</a>;
<a name="l00749"></a>00749                 <span class="keywordflow">break</span>;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751             <span class="keywordflow">case</span> <span class="stringliteral">'sendmail'</span>:
<a name="l00752"></a>00752                 <span class="comment">// Get flat representation of headers</span>
<a name="l00753"></a>00753                 <span class="keywordflow">foreach</span> ($this-&gt;headers as $name =&gt; $value) {
<a name="l00754"></a>00754                     <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>[] = $name . <span class="stringliteral">': '</span> . $this-&gt;<a class="code" href="classRmail.html#bd56ea9b417fbaceafeca8e0ba6d76b7" title="Function to encode a header if necessary according to RFC2047.">encodeHeader</a>($value, $this-&gt;build_params[<span class="stringliteral">'head_charset'</span>]);
<a name="l00755"></a>00755                 }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757                 <span class="comment">// Encode To:</span>
<a name="l00758"></a>00758                 <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>[] = <span class="stringliteral">'To: '</span> . $this-&gt;<a class="code" href="classRmail.html#bd56ea9b417fbaceafeca8e0ba6d76b7" title="Function to encode a header if necessary according to RFC2047.">encodeHeader</a>(implode(<span class="stringliteral">', '</span>, $recipients), $this-&gt;build_params[<span class="stringliteral">'head_charset'</span>]);
<a name="l00759"></a>00759 
<a name="l00760"></a>00760                 <span class="comment">// Get return path arg for sendmail command if necessary</span>
<a name="l00761"></a>00761                 $returnPath = <span class="stringliteral">''</span>;
<a name="l00762"></a>00762                 <span class="keywordflow">if</span> (!empty($this-&gt;return_path)) {
<a name="l00763"></a>00763                     $returnPath = <span class="stringliteral">'-f'</span> . $this-&gt;return_path;
<a name="l00764"></a>00764                 }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766                 $pipe = popen($this-&gt;sendmail_path . <span class="stringliteral">" "</span> . $returnPath, <span class="charliteral">'w'</span>);
<a name="l00767"></a>00767                     $bytes = fputs($pipe, implode(CRLF, <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>) . CRLF . CRLF . $this-&gt;output);
<a name="l00768"></a>00768                 $r = pclose($pipe);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770                 <span class="keywordflow">return</span> $r;
<a name="l00771"></a>00771                 <span class="keywordflow">break</span>;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773             <span class="keywordflow">case</span> <span class="stringliteral">'smtp'</span>:
<a name="l00774"></a>00774                 require_once(dirname(__FILE__) . <span class="stringliteral">'/smtp.php'</span>);
<a name="l00775"></a>00775                 require_once(dirname(__FILE__) . <span class="stringliteral">'/RFC822.php'</span>);
<a name="l00776"></a>00776                 $smtp = &amp;<a class="code" href="classsmtp.html#eae8813b81d81f4e797f8fec8d9b928c" title="Connect function.">smtp::connect</a>($this-&gt;smtp_params);
<a name="l00777"></a>00777                 
<a name="l00778"></a>00778                 <span class="comment">// Parse recipients argument for internet addresses</span>
<a name="l00779"></a>00779                 <span class="keywordflow">foreach</span> ($recipients as $recipient) {
<a name="l00780"></a>00780                     $addresses = <a class="code" href="classMail__RFC822.html#69f432d505492514b7b14035132e3ac6" title="Starts the whole process.">Mail_RFC822::parseAddressList</a>($recipient, $this-&gt;smtp_params[<span class="stringliteral">'helo'</span>], null, <span class="keyword">false</span>);
<a name="l00781"></a>00781                     <span class="keywordflow">foreach</span> ($addresses as <a class="code" href="example_8php.html#faef812b1a73e88089d4b7e5e151bc29" title="Send the email.">$address</a>) {
<a name="l00782"></a>00782                         $smtp_recipients[] = sprintf(<span class="stringliteral">'%s@%s'</span>, $address-&gt;mailbox, $address-&gt;host);
<a name="l00783"></a>00783                     }
<a name="l00784"></a>00784                 }
<a name="l00785"></a>00785                 unset($addresses); <span class="comment">// These are reused</span>
<a name="l00786"></a>00786                 unset(<a class="code" href="example_8php.html#faef812b1a73e88089d4b7e5e151bc29" title="Send the email.">$address</a>);   <span class="comment">// These are reused</span>
<a name="l00787"></a>00787 
<a name="l00788"></a>00788                 <span class="comment">// Get flat representation of headers, parsing</span>
<a name="l00789"></a>00789                 <span class="comment">// Cc and Bcc as we go</span>
<a name="l00790"></a>00790                 <span class="keywordflow">foreach</span> ($this-&gt;headers as $name =&gt; $value) {
<a name="l00791"></a>00791                     <span class="keywordflow">if</span> ($name == <span class="stringliteral">'Cc'</span> OR $name == <span class="stringliteral">'Bcc'</span>) {
<a name="l00792"></a>00792                         $addresses = <a class="code" href="classMail__RFC822.html#69f432d505492514b7b14035132e3ac6" title="Starts the whole process.">Mail_RFC822::parseAddressList</a>($value, $this-&gt;smtp_params[<span class="stringliteral">'helo'</span>], null, <span class="keyword">false</span>);
<a name="l00793"></a>00793                         <span class="keywordflow">foreach</span> ($addresses as <a class="code" href="example_8php.html#faef812b1a73e88089d4b7e5e151bc29" title="Send the email.">$address</a>) {
<a name="l00794"></a>00794                             $smtp_recipients[] = sprintf(<span class="stringliteral">'%s@%s'</span>, $address-&gt;mailbox, $address-&gt;host);
<a name="l00795"></a>00795                         }
<a name="l00796"></a>00796                     }
<a name="l00797"></a>00797                     <span class="keywordflow">if</span> ($name == <span class="stringliteral">'Bcc'</span>) {
<a name="l00798"></a>00798                         <span class="keywordflow">continue</span>;
<a name="l00799"></a>00799                     }
<a name="l00800"></a>00800                     <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>[] = $name . <span class="stringliteral">': '</span> . $this-&gt;<a class="code" href="classRmail.html#bd56ea9b417fbaceafeca8e0ba6d76b7" title="Function to encode a header if necessary according to RFC2047.">encodeHeader</a>($value, $this-&gt;build_params[<span class="stringliteral">'head_charset'</span>]);
<a name="l00801"></a>00801                 }
<a name="l00802"></a>00802                 <span class="comment">// Add To header based on $recipients argument</span>
<a name="l00803"></a>00803                 <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>[] = <span class="stringliteral">'To: '</span> . $this-&gt;<a class="code" href="classRmail.html#bd56ea9b417fbaceafeca8e0ba6d76b7" title="Function to encode a header if necessary according to RFC2047.">encodeHeader</a>(implode(<span class="stringliteral">', '</span>, $recipients), $this-&gt;build_params[<span class="stringliteral">'head_charset'</span>]);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805                 <span class="comment">// Add headers to send_params</span>
<a name="l00806"></a>00806                 $send_params[<span class="stringliteral">'headers'</span>]    = <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>;
<a name="l00807"></a>00807                 $send_params[<span class="stringliteral">'recipients'</span>] = array_values(array_unique($smtp_recipients));
<a name="l00808"></a>00808                 $send_params[<span class="stringliteral">'body'</span>]       = $this-&gt;output;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810                 <span class="comment">// Setup return path</span>
<a name="l00811"></a>00811                 <span class="keywordflow">if</span> (isset($this-&gt;return_path)) {
<a name="l00812"></a>00812                     $send_params[<span class="stringliteral">'from'</span>] = $this-&gt;return_path;
<a name="l00813"></a>00813                 } elseif (!empty($this-&gt;headers[<span class="stringliteral">'From'</span>])) {
<a name="l00814"></a>00814                     $from = <a class="code" href="classMail__RFC822.html#69f432d505492514b7b14035132e3ac6" title="Starts the whole process.">Mail_RFC822::parseAddressList</a>($this-&gt;headers[<span class="stringliteral">'From'</span>]);
<a name="l00815"></a>00815                     $send_params[<span class="stringliteral">'from'</span>] = sprintf(<span class="stringliteral">'%s@%s'</span>, $from[0]-&gt;mailbox, $from[0]-&gt;host);
<a name="l00816"></a>00816                 } <span class="keywordflow">else</span> {
<a name="l00817"></a>00817                     $send_params[<span class="stringliteral">'from'</span>] = <span class="stringliteral">'postmaster@'</span> . $this-&gt;smtp_params[<span class="stringliteral">'helo'</span>];
<a name="l00818"></a>00818                 }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820                 <span class="comment">// Send it</span>
<a name="l00821"></a>00821                 <span class="keywordflow">if</span> (!$smtp-&gt;send($send_params)) {
<a name="l00822"></a>00822                     $this-&gt;errors = $smtp-&gt;getErrors();
<a name="l00823"></a>00823                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00824"></a>00824                 }
<a name="l00825"></a>00825                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00826"></a>00826                 <span class="keywordflow">break</span>;
<a name="l00827"></a>00827         }
<a name="l00828"></a>00828     }
<a name="l00829"></a>00829 
<a name="l00840"></a><a class="code" href="classRmail.html#880f2b96ece101146004d33bf5c3f585">00840</a>     <span class="keyword">public</span> function <a class="code" href="classRmail.html#880f2b96ece101146004d33bf5c3f585" title="Use this method to return the email in message/rfc822 format.">getRFC822</a>($recipients, $type = <span class="stringliteral">'mail'</span>)
<a name="l00841"></a>00841     {
<a name="l00842"></a>00842         <span class="comment">// Make up the date header as according to RFC822</span>
<a name="l00843"></a>00843         $this-&gt;<a class="code" href="classRmail.html#2d3d8d43cbe52259d77c3125342e3656" title="Accessor to set a header.">setHeader</a>(<span class="stringliteral">'Date'</span>, date(<span class="stringliteral">'D, d M y H:i:s O'</span>));
<a name="l00844"></a>00844 
<a name="l00845"></a>00845         <span class="keywordflow">if</span> (!defined(<span class="stringliteral">'CRLF'</span>)) {
<a name="l00846"></a>00846             $this-&gt;<a class="code" href="classRmail.html#758361a90532ff464e16c7aa557b7db1" title="Accessor to set the CRLF style.">setCRLF</a>($type == <span class="stringliteral">'mail'</span> ? <span class="stringliteral">"\n"</span> : <span class="stringliteral">"\r\n"</span>);
<a name="l00847"></a>00847         }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849         $this-&gt;<a class="code" href="classRmail.html#09e5cbded6e5a3c6ccde71d5963572f1" title="Builds the multipart message.">build</a>();
<a name="l00850"></a>00850 
<a name="l00851"></a>00851         <span class="comment">// Return path ?</span>
<a name="l00852"></a>00852         <span class="keywordflow">if</span> (isset($this-&gt;return_path)) {
<a name="l00853"></a>00853             <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>[] = <span class="stringliteral">'Return-Path: '</span> . $this-&gt;return_path;
<a name="l00854"></a>00854         }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856         <span class="comment">// Get flat representation of headers</span>
<a name="l00857"></a>00857         <span class="keywordflow">foreach</span> ($this-&gt;headers as $name =&gt; $value) {
<a name="l00858"></a>00858             <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>[] = $name . <span class="stringliteral">': '</span> . $value;
<a name="l00859"></a>00859         }
<a name="l00860"></a>00860         <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>[] = <span class="stringliteral">'To: '</span> . implode(<span class="stringliteral">', '</span>, $recipients);
<a name="l00861"></a>00861 
<a name="l00862"></a>00862         <span class="keywordflow">return</span> implode(CRLF, <a class="code" href="classRmail.html#5770ec559e00fcba9837d3a052ec52eb" title="The main message headers array.">$headers</a>) . CRLF . CRLF . $this-&gt;output;
<a name="l00863"></a>00863     }
<a name="l00864"></a>00864 } <span class="comment">// End of class.</span>
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 
<a name="l00870"></a><a class="code" href="classattachment.html">00870</a> <span class="keyword">class </span><a class="code" href="classattachment.html" title="Attachment classes.">attachment</a>
<a name="l00871"></a>00871 {
<a name="l00876"></a><a class="code" href="classattachment.html#c4e115192a2f5beb025cb0e4a46aa608">00876</a>     <span class="keyword">public</span> <a class="code" href="classattachment.html#c4e115192a2f5beb025cb0e4a46aa608">$data</a>;
<a name="l00877"></a>00877     
<a name="l00882"></a><a class="code" href="classattachment.html#de61e76c866d814882d1459fceb8b67b">00882</a>     <span class="keyword">public</span> <a class="code" href="classattachment.html#de61e76c866d814882d1459fceb8b67b">$name</a>;
<a name="l00883"></a>00883     
<a name="l00888"></a><a class="code" href="classattachment.html#69858b984f5c9a9ca468a11f2f67ec59">00888</a>     <span class="keyword">public</span> <a class="code" href="classattachment.html#69858b984f5c9a9ca468a11f2f67ec59">$contentType</a>;
<a name="l00889"></a>00889     
<a name="l00894"></a><a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">00894</a>     <span class="keyword">public</span> <a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a>;
<a name="l00895"></a>00895     
<a name="l00904"></a><a class="code" href="classattachment.html#3afef0633d1bff6cb9c25bbead0ca353">00904</a>     <span class="keyword">public</span> function <a class="code" href="classattachment.html#3afef0633d1bff6cb9c25bbead0ca353" title="Constructor.">__construct</a>(<a class="code" href="classattachment.html#c4e115192a2f5beb025cb0e4a46aa608">$data</a>, <a class="code" href="classattachment.html#de61e76c866d814882d1459fceb8b67b">$name</a>, <a class="code" href="classattachment.html#69858b984f5c9a9ca468a11f2f67ec59">$contentType</a>, <a class="code" href="interfaceiEncoding.html" title="Encoding interface.">iEncoding</a> <a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a>)
<a name="l00905"></a>00905     {
<a name="l00906"></a>00906         $this-&gt;data        = <a class="code" href="classattachment.html#c4e115192a2f5beb025cb0e4a46aa608">$data</a>;
<a name="l00907"></a>00907         $this-&gt;name        = <a class="code" href="classattachment.html#de61e76c866d814882d1459fceb8b67b">$name</a>;
<a name="l00908"></a>00908         $this-&gt;contentType = <a class="code" href="classattachment.html#69858b984f5c9a9ca468a11f2f67ec59">$contentType</a>;
<a name="l00909"></a>00909         $this-&gt;encoding    = $encoding;
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911 }
<a name="l00912"></a>00912 
<a name="l00913"></a>00913 
<a name="l00917"></a><a class="code" href="classfileAttachment.html">00917</a> <span class="keyword">class </span><a class="code" href="classfileAttachment.html" title="File based attachment class.">fileAttachment</a> <span class="keyword">extends</span> <a class="code" href="classattachment.html" title="Attachment classes.">attachment</a>
<a name="l00918"></a>00918 {
<a name="l00926"></a><a class="code" href="classfileAttachment.html#a57216b2432471c54097a365a1c89466">00926</a>     <span class="keyword">public</span> function <a class="code" href="classfileAttachment.html#a57216b2432471c54097a365a1c89466" title="Constructor.">__construct</a>($filename, <a class="code" href="classattachment.html#69858b984f5c9a9ca468a11f2f67ec59">$contentType</a> = <span class="stringliteral">'application/octet-stream'</span>, <a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a> = null)
<a name="l00927"></a>00927     {
<a name="l00928"></a>00928         <a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a> = is_null(<a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a>) ? <span class="keyword">new</span> <a class="code" href="classBase64Encoding.html" title="Base64 Encoding class.">Base64Encoding</a>() : <a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a>;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930         <a class="code" href="classfileAttachment.html#a57216b2432471c54097a365a1c89466" title="Constructor.">parent::__construct</a>(file_get_contents($filename), basename($filename), <a class="code" href="classattachment.html#69858b984f5c9a9ca468a11f2f67ec59">$contentType</a>, <a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a>);
<a name="l00931"></a>00931     }
<a name="l00932"></a>00932 }
<a name="l00933"></a>00933 
<a name="l00934"></a>00934 
<a name="l00939"></a><a class="code" href="classstringAttachment.html">00939</a> <span class="keyword">class </span><a class="code" href="classstringAttachment.html" title="Attachment class to handle attachments which are contained in a variable.">stringAttachment</a> <span class="keyword">extends</span> <a class="code" href="classattachment.html" title="Attachment classes.">attachment</a>
<a name="l00940"></a>00940 {
<a name="l00949"></a><a class="code" href="classstringAttachment.html#83c9a7e0947b7f816d8572b4556cb0f4">00949</a>     <span class="keyword">public</span> function <a class="code" href="classstringAttachment.html#83c9a7e0947b7f816d8572b4556cb0f4" title="Constructor.">__construct</a>(<a class="code" href="classattachment.html#c4e115192a2f5beb025cb0e4a46aa608">$data</a>, <a class="code" href="classattachment.html#de61e76c866d814882d1459fceb8b67b">$name</a> = <span class="stringliteral">''</span>, <a class="code" href="classattachment.html#69858b984f5c9a9ca468a11f2f67ec59">$contentType</a> = <span class="stringliteral">'application/octet-stream'</span>, <a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a> = null)
<a name="l00950"></a>00950     {
<a name="l00951"></a>00951         <a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a> = is_null(<a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a>) ? <span class="keyword">new</span> <a class="code" href="classBase64Encoding.html" title="Base64 Encoding class.">Base64Encoding</a>() : <a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a>;
<a name="l00952"></a>00952         
<a name="l00953"></a>00953         <a class="code" href="classstringAttachment.html#83c9a7e0947b7f816d8572b4556cb0f4" title="Constructor.">parent::__construct</a>(<a class="code" href="classattachment.html#c4e115192a2f5beb025cb0e4a46aa608">$data</a>, <a class="code" href="classattachment.html#de61e76c866d814882d1459fceb8b67b">$name</a>, <a class="code" href="classattachment.html#69858b984f5c9a9ca468a11f2f67ec59">$contentType</a>, <a class="code" href="classattachment.html#45b7e698c2b4c2f75ceddeb32c6dc925">$encoding</a>);
<a name="l00954"></a>00954     }
<a name="l00955"></a>00955 }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957 
<a name="l00961"></a><a class="code" href="classfileEmbeddedImage.html">00961</a> <span class="keyword">class </span><a class="code" href="classfileEmbeddedImage.html" title="File based embedded image class.">fileEmbeddedImage</a> <span class="keyword">extends</span> <a class="code" href="classfileAttachment.html" title="File based attachment class.">fileAttachment</a>
<a name="l00962"></a>00962 {
<a name="l00963"></a>00963 }
<a name="l00964"></a>00964 
<a name="l00965"></a>00965 
<a name="l00969"></a><a class="code" href="classstringEmbeddedImage.html">00969</a> <span class="keyword">class </span><a class="code" href="classstringEmbeddedImage.html" title="String based embedded image class.">stringEmbeddedImage</a> <span class="keyword">extends</span> <a class="code" href="classstringAttachment.html" title="Attachment class to handle attachments which are contained in a variable.">stringAttachment</a>
<a name="l00970"></a>00970 {
<a name="l00971"></a>00971 }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973 
<a name="l00980"></a><a class="code" href="interfaceiEncoding.html">00980</a> interface <a class="code" href="interfaceiEncoding.html" title="Encoding interface.">iEncoding</a>
<a name="l00981"></a>00981 {
<a name="l00982"></a>00982     <span class="keyword">public</span> function encode($input);
<a name="l00983"></a>00983     <span class="keyword">public</span> function getType();
<a name="l00984"></a>00984 }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 
<a name="l00990"></a><a class="code" href="classBase64Encoding.html">00990</a> <span class="keyword">class </span><a class="code" href="classBase64Encoding.html" title="Base64 Encoding class.">Base64Encoding</a> <span class="keyword">implements</span> <a class="code" href="interfaceiEncoding.html" title="Encoding interface.">iEncoding</a>
<a name="l00991"></a>00991 {
<a name="l00992"></a>00992     <span class="comment">/*</span>
<a name="l00993"></a>00993 <span class="comment">    * Function to encode data using</span>
<a name="l00994"></a>00994 <span class="comment">    * base64 encoding.</span>
<a name="l00995"></a>00995 <span class="comment">    * </span>
<a name="l00996"></a>00996 <span class="comment">    * @param string $input Data to encode</span>
<a name="l00997"></a>00997 <span class="comment">    */</span>
<a name="l00998"></a><a class="code" href="classBase64Encoding.html#1b91170c5ef3b4a12166a790a6c312f4">00998</a>     <span class="keyword">public</span> function <a class="code" href="classBase64Encoding.html#1b91170c5ef3b4a12166a790a6c312f4">encode</a>($input)
<a name="l00999"></a>00999     {
<a name="l01000"></a>01000         <span class="keywordflow">return</span> rtrim(chunk_split(base64_encode($input), 76, defined(<span class="stringliteral">'MAIL_MIME_PART_CRLF'</span>) ? MAIL_MIME_PART_CRLF : <span class="stringliteral">"\r\n"</span>));
<a name="l01001"></a>01001     }
<a name="l01002"></a>01002     
<a name="l01006"></a><a class="code" href="classBase64Encoding.html#edb851a38e7a0a2ac9a363986741fb73">01006</a>     <span class="keyword">public</span> function <a class="code" href="classBase64Encoding.html#edb851a38e7a0a2ac9a363986741fb73" title="Returns type.">getType</a>()
<a name="l01007"></a>01007     {
<a name="l01008"></a>01008         <span class="keywordflow">return</span> <span class="stringliteral">'base64'</span>;
<a name="l01009"></a>01009     }
<a name="l01010"></a>01010 }
<a name="l01011"></a>01011 
<a name="l01012"></a>01012 
<a name="l01016"></a><a class="code" href="classQPrintEncoding.html">01016</a> <span class="keyword">class </span><a class="code" href="classQPrintEncoding.html" title="Quoted Printable Encoding class.">QPrintEncoding</a> <span class="keyword">implements</span> <a class="code" href="interfaceiEncoding.html" title="Encoding interface.">iEncoding</a>
<a name="l01017"></a>01017 {
<a name="l01018"></a>01018     <span class="comment">/*</span>
<a name="l01019"></a>01019 <span class="comment">    * Function to encode data using</span>
<a name="l01020"></a>01020 <span class="comment">    * quoted-printable encoding.</span>
<a name="l01021"></a>01021 <span class="comment">    * </span>
<a name="l01022"></a>01022 <span class="comment">    * @param string $input Data to encode</span>
<a name="l01023"></a>01023 <span class="comment">    */</span>
<a name="l01024"></a><a class="code" href="classQPrintEncoding.html#9a27f2c66795ac5af076ad0e56e1d21b">01024</a>     <span class="keyword">public</span> function <a class="code" href="classQPrintEncoding.html#9a27f2c66795ac5af076ad0e56e1d21b">encode</a>($input)
<a name="l01025"></a>01025     {
<a name="l01026"></a>01026         <span class="comment">// Replace non printables</span>
<a name="l01027"></a>01027         $input    = preg_replace(<span class="stringliteral">'/([^\x20\x21-\x3C\x3E-\x7E\x0A\x0D])/e'</span>, <span class="stringliteral">'sprintf("=%02X", ord("\1"))'</span>, $input);
<a name="l01028"></a>01028         $inputLen = strlen($input);
<a name="l01029"></a>01029         $outLines = array();
<a name="l01030"></a>01030         $output   = <span class="stringliteral">''</span>;
<a name="l01031"></a>01031 
<a name="l01032"></a>01032         $lines = preg_split(<span class="stringliteral">'/\r?\n/'</span>, $input);
<a name="l01033"></a>01033         
<a name="l01034"></a>01034         <span class="comment">// Walk through each line</span>
<a name="l01035"></a>01035         <span class="keywordflow">for</span> ($i=0; $i&lt;count($lines); $i++) {
<a name="l01036"></a>01036             <span class="comment">// Is line too long ?</span>
<a name="l01037"></a>01037             <span class="keywordflow">if</span> (strlen($lines[$i]) &gt; $lineMax) {
<a name="l01038"></a>01038                 $outLines[] = substr($lines[$i], 0, $lineMax - 1) . <span class="stringliteral">"="</span>; <span class="comment">// \r\n Gets added when lines are imploded</span>
<a name="l01039"></a>01039                 $lines[$i] = substr($lines[$i], $lineMax - 1);
<a name="l01040"></a>01040                 $i--; <span class="comment">// Ensure this line gets redone as we just changed it</span>
<a name="l01041"></a>01041             } <span class="keywordflow">else</span> {
<a name="l01042"></a>01042                 $outLines[] = $lines[$i];
<a name="l01043"></a>01043             }
<a name="l01044"></a>01044         }
<a name="l01045"></a>01045         
<a name="l01046"></a>01046         <span class="comment">// Convert trailing whitespace    </span>
<a name="l01047"></a>01047         $output = preg_replace(<span class="stringliteral">'/(\x20+)$/me'</span>, <span class="stringliteral">'str_replace(" ", "=20", "\1")'</span>, $outLines);
<a name="l01048"></a>01048 
<a name="l01049"></a>01049         <span class="keywordflow">return</span> implode(<span class="stringliteral">"\r\n"</span>, $output);
<a name="l01050"></a>01050     }
<a name="l01051"></a>01051     
<a name="l01055"></a><a class="code" href="classQPrintEncoding.html#4d89113811f46bd38511f1cdf2ee5238">01055</a>     <span class="keyword">public</span> function <a class="code" href="classQPrintEncoding.html#4d89113811f46bd38511f1cdf2ee5238" title="Returns type.">getType</a>()
<a name="l01056"></a>01056     {
<a name="l01057"></a>01057         <span class="keywordflow">return</span> <span class="stringliteral">'quoted-printable'</span>;
<a name="l01058"></a>01058     }
<a name="l01059"></a>01059 }
<a name="l01060"></a>01060 
<a name="l01061"></a>01061 
<a name="l01065"></a><a class="code" href="classSevenBitEncoding.html">01065</a> <span class="keyword">class </span><a class="code" href="classSevenBitEncoding.html" title="7Bit Encoding class">SevenBitEncoding</a> <span class="keyword">implements</span> <a class="code" href="interfaceiEncoding.html" title="Encoding interface.">iEncoding</a>
<a name="l01066"></a>01066 {
<a name="l01067"></a>01067     <span class="comment">/*</span>
<a name="l01068"></a>01068 <span class="comment">    * Function to "encode" data using</span>
<a name="l01069"></a>01069 <span class="comment">    * 7bit encoding.</span>
<a name="l01070"></a>01070 <span class="comment">    * </span>
<a name="l01071"></a>01071 <span class="comment">    * @param string $input Data to encode</span>
<a name="l01072"></a>01072 <span class="comment">    */</span>
<a name="l01073"></a><a class="code" href="classSevenBitEncoding.html#9ee743705426030e1774f8d32cc38357">01073</a>     <span class="keyword">public</span> function <a class="code" href="classSevenBitEncoding.html#9ee743705426030e1774f8d32cc38357">encode</a>($input)
<a name="l01074"></a>01074     {
<a name="l01075"></a>01075         <span class="keywordflow">return</span> $input;
<a name="l01076"></a>01076     }
<a name="l01077"></a>01077     
<a name="l01081"></a><a class="code" href="classSevenBitEncoding.html#58c8ba8b67e722683e07b27d73f7be80">01081</a>     <span class="keyword">public</span> function <a class="code" href="classSevenBitEncoding.html#58c8ba8b67e722683e07b27d73f7be80" title="Returns type.">getType</a>()
<a name="l01082"></a>01082     {
<a name="l01083"></a>01083         <span class="keywordflow">return</span> <span class="stringliteral">'7bit'</span>;
<a name="l01084"></a>01084     }
<a name="l01085"></a>01085 }
<a name="l01086"></a>01086 
<a name="l01087"></a>01087 
<a name="l01091"></a><a class="code" href="classEightBitEncoding.html">01091</a> <span class="keyword">class </span><a class="code" href="classEightBitEncoding.html" title="8Bit Encoding class">EightBitEncoding</a> <span class="keyword">implements</span> <a class="code" href="interfaceiEncoding.html" title="Encoding interface.">iEncoding</a>
<a name="l01092"></a>01092 {
<a name="l01093"></a>01093     <span class="comment">/*</span>
<a name="l01094"></a>01094 <span class="comment">    * Function to "encode" data using</span>
<a name="l01095"></a>01095 <span class="comment">    * 8bit encoding.</span>
<a name="l01096"></a>01096 <span class="comment">    * </span>
<a name="l01097"></a>01097 <span class="comment">    * @param string $input Data to encode</span>
<a name="l01098"></a>01098 <span class="comment">    */</span>
<a name="l01099"></a><a class="code" href="classEightBitEncoding.html#2a2fb82047081310f62320ae983db013">01099</a>     <span class="keyword">public</span> function <a class="code" href="classEightBitEncoding.html#2a2fb82047081310f62320ae983db013">encode</a>($input)
<a name="l01100"></a>01100     {
<a name="l01101"></a>01101         <span class="keywordflow">return</span> $input;
<a name="l01102"></a>01102     }
<a name="l01103"></a>01103     
<a name="l01107"></a><a class="code" href="classEightBitEncoding.html#f6ca461d89b1d8eb60f20585c04d3303">01107</a>     <span class="keyword">public</span> function <a class="code" href="classEightBitEncoding.html#f6ca461d89b1d8eb60f20585c04d3303" title="Returns type.">getType</a>()
<a name="l01108"></a>01108     {
<a name="l01109"></a>01109         <span class="keywordflow">return</span> <span class="stringliteral">'8bit'</span>;
<a name="l01110"></a>01110     }
<a name="l01111"></a>01111 }
<a name="l01112"></a>01112 ?&gt;
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed May 6 23:10:49 2009 for fareofficelib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
